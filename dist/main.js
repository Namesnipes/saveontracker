/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();const e=function(t,e){if(!t)throw n(e)},n=function(t){return new Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+t)},i=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let s=t.charCodeAt(i);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=63&s|128):55296==(64512&s)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(s=65536+((1023&s)<<10)+(1023&t.charCodeAt(++i)),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=63&s|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=63&s|128)}return e},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let e=0;e<t.length;e+=3){const s=t[e],r=e+1<t.length,o=r?t[e+1]:0,a=e+2<t.length,h=a?t[e+2]:0,l=s>>2,c=(3&s)<<4|o>>4;let u=(15&o)<<2|h>>6,d=63&h;a||(d=64,r||(u=64)),i.push(n[l],n[c],n[u],n[d])}return i.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(i(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,i=0;for(;n<t.length;){const s=t[n++];if(s<128)e[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=t[n++];e[i++]=String.fromCharCode((31&s)<<6|63&r)}else if(s>239&&s<365){const r=((7&s)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[i++]=String.fromCharCode(55296+(r>>10)),e[i++]=String.fromCharCode(56320+(1023&r))}else{const r=t[n++],o=t[n++];e[i++]=String.fromCharCode((15&s)<<12|(63&r)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let e=0;e<t.length;){const s=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const h=e<t.length?n[t.charAt(e)]:64;if(++e,null==s||null==o||null==a||null==h)throw new r;const l=s<<2|o>>4;if(i.push(l),64!==a){const t=o<<4&240|a>>2;if(i.push(t),64!==h){const t=a<<6&192|h;i.push(t)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class r extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const o=function(t){const e=i(t);return s.encodeByteArray(e,!0)},a=function(t){return o(t).replace(/\./g,"")},h=function(t){try{return s.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function l(t){return c(void 0,t)}function c(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)e.hasOwnProperty(n)&&"__proto__"!==n&&(t[n]=c(t[n],e[n]));return t}const u=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t.g)return t.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&h(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},d=()=>{var t;return null===(t=u())||void 0===t?void 0:t.config};class p{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function f(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")}class g extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,g.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,_.prototype.create)}}class _{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},i=`${this.service}/${t}`,s=this.errors[t],r=s?function(t,e){return t.replace(m,((t,n)=>{const i=e[n];return null!=i?String(i):`<${n}?>`}))}(s,n):"Error",o=`${this.serviceName}: ${r} (${i}).`;return new g(i,o,n)}}const m=/\{\$([^}]+)}/g;function y(t){return JSON.parse(t)}function v(t){return JSON.stringify(t)}const w=function(t){let e={},n={},i={},s="";try{const r=t.split(".");e=y(h(r[0])||""),n=y(h(r[1])||""),s=r[2],i=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:i,signature:s}};function C(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function b(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function E(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function T(t,e,n){const i={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(i[s]=e.call(n,t[s],s,t));return i}function I(t,e){if(t===e)return!0;const n=Object.keys(t),i=Object.keys(e);for(const s of n){if(!i.includes(s))return!1;const n=t[s],r=e[s];if(S(n)&&S(r)){if(!I(n,r))return!1}else if(n!==r)return!1}for(const t of i)if(!n.includes(t))return!1;return!0}function S(t){return null!==t&&"object"==typeof t}class k{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(t,e){e||(e=0);const n=this.W_;if("string"==typeof t)for(let i=0;i<16;i++)n[i]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(let i=0;i<16;i++)n[i]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(let t=16;t<80;t++){const e=n[t-3]^n[t-8]^n[t-14]^n[t-16];n[t]=4294967295&(e<<1|e>>>31)}let i,s,r=this.chain_[0],o=this.chain_[1],a=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(let t=0;t<80;t++){t<40?t<20?(i=h^o&(a^h),s=1518500249):(i=o^a^h,s=1859775393):t<60?(i=o&a|h&(o|a),s=2400959708):(i=o^a^h,s=3395469782);const e=(r<<5|r>>>27)+i+l+s+n[t]&4294967295;l=h,h=a,a=4294967295&(o<<30|o>>>2),o=r,r=e}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(t,e){if(null==t)return;void 0===e&&(e=t.length);const n=e-this.blockSize;let i=0;const s=this.buf_;let r=this.inbuf_;for(;i<e;){if(0===r)for(;i<=n;)this.compress_(t,i),i+=this.blockSize;if("string"==typeof t){for(;i<e;)if(s[r]=t.charCodeAt(i),++r,++i,r===this.blockSize){this.compress_(s),r=0;break}}else for(;i<e;)if(s[r]=t[i],++r,++i,r===this.blockSize){this.compress_(s),r=0;break}}this.inbuf_=r,this.total_+=e}digest(){const t=[];let e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let t=this.blockSize-1;t>=56;t--)this.buf_[t]=255&e,e/=256;this.compress_(this.buf_);let n=0;for(let e=0;e<5;e++)for(let i=24;i>=0;i-=8)t[n]=this.chain_[e]>>i&255,++n;return t}}function N(t,e){return`${t} failed: ${e} argument `}const P=function(t){let e=0;for(let n=0;n<t.length;n++){const i=t.charCodeAt(n);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,n++):e+=3}return e};function R(t){return t&&t._delegate?t._delegate:t}class x{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const A="[DEFAULT]";class D{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new p;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),i=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(i)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:A})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=A){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=A){return this.instances.has(t)}getOptions(t=A){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(i);return i}onInit(t,e){var n;const i=this.normalizeInstanceIdentifier(e),s=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;s.add(t),this.onInitCallbacks.set(i,s);const r=this.instances.get(i);return r&&t(r,i),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const i of n)try{i(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=t,i===A?void 0:i),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var i;return n||null}normalizeInstanceIdentifier(t=A){return this.component?this.component.multipleInstances?t:A:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class O{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new D(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const L=[];var M,F;(F=M||(M={}))[F.DEBUG=0]="DEBUG",F[F.VERBOSE=1]="VERBOSE",F[F.INFO=2]="INFO",F[F.WARN=3]="WARN",F[F.ERROR=4]="ERROR",F[F.SILENT=5]="SILENT";const q={debug:M.DEBUG,verbose:M.VERBOSE,info:M.INFO,warn:M.WARN,error:M.ERROR,silent:M.SILENT},U=M.INFO,j={[M.DEBUG]:"log",[M.VERBOSE]:"log",[M.INFO]:"info",[M.WARN]:"warn",[M.ERROR]:"error"},B=(t,e,...n)=>{if(e<t.logLevel)return;const i=(new Date).toISOString(),s=j[e];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[s](`[${i}]  ${t.name}:`,...n)};class H{constructor(t){this.name=t,this._logLevel=U,this._logHandler=B,this._userLogHandler=null,L.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in M))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?q[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,M.DEBUG,...t),this._logHandler(this,M.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,M.VERBOSE,...t),this._logHandler(this,M.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,M.INFO,...t),this._logHandler(this,M.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,M.WARN,...t),this._logHandler(this,M.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,M.ERROR,...t),this._logHandler(this,M.ERROR,...t)}}const z=(t,e)=>e.some((e=>t instanceof e));let W,V;const $=new WeakMap,Y=new WeakMap,K=new WeakMap,G=new WeakMap,X=new WeakMap;let Q={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return Y.get(t);if("objectStoreNames"===e)return t.objectStoreNames||K.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Z(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function J(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(V||(V=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(tt(this),t),Z($.get(this))}:function(...t){return Z(e.apply(tt(this),t))}:function(t,...n){const i=e.call(tt(this),t,...n);return K.set(i,t.sort?t.sort():[t]),Z(i)}:(t instanceof IDBTransaction&&function(t){if(Y.has(t))return;const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",r),t.removeEventListener("abort",r)},s=()=>{e(),i()},r=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",r),t.addEventListener("abort",r)}));Y.set(t,e)}(t),z(t,W||(W=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,Q):t);var e}function Z(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",r)},s=()=>{e(Z(t.result)),i()},r=()=>{n(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",r)}));return e.then((e=>{e instanceof IDBCursor&&$.set(e,t)})).catch((()=>{})),X.set(e,t),e}(t);if(G.has(t))return G.get(t);const e=J(t);return e!==t&&(G.set(t,e),X.set(e,t)),e}const tt=t=>X.get(t),et=["get","getKey","getAll","getAllKeys","count"],nt=["put","add","delete","clear"],it=new Map;function st(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(it.get(e))return it.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,s=nt.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!et.includes(n))return;const r=async function(t,...e){const r=this.transaction(t,s?"readwrite":"readonly");let o=r.store;return i&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),s&&r.done]))[0]};return it.set(e,r),r}var rt;rt=Q,Q={...rt,get:(t,e,n)=>st(t,e)||rt.get(t,e,n),has:(t,e)=>!!st(t,e)||rt.has(t,e)};class ot{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const at="@firebase/app",ht="0.9.16",lt=new H("@firebase/app"),ct="[DEFAULT]",ut={[at]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},dt=new Map,pt=new Map;function ft(t,e){try{t.container.addComponent(e)}catch(n){lt.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function gt(t){const e=t.name;if(pt.has(e))return lt.debug(`There were multiple attempts to register component ${e}.`),!1;pt.set(e,t);for(const e of dt.values())ft(e,t);return!0}const _t=new _("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class mt{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new x("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw _t.create("app-deleted",{appName:this._name})}}const yt="10.2.0";function vt(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const i=Object.assign({name:ct,automaticDataCollectionEnabled:!1},e),s=i.name;if("string"!=typeof s||!s)throw _t.create("bad-app-name",{appName:String(s)});if(n||(n=d()),!n)throw _t.create("no-options");const r=dt.get(s);if(r){if(I(n,r.options)&&I(i,r.config))return r;throw _t.create("duplicate-app",{appName:s})}const o=new O(s);for(const t of pt.values())o.addComponent(t);const a=new mt(n,i,o);return dt.set(s,a),a}function wt(t,e,n){var i;let s=null!==(i=ut[t])&&void 0!==i?i:t;n&&(s+=`-${n}`);const r=s.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const t=[`Unable to register library "${s}" with version "${e}":`];return r&&t.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void lt.warn(t.join(" "))}gt(new x(`${s}-version`,(()=>({library:s,version:e})),"VERSION"))}const Ct="firebase-heartbeat-database",bt=1,Et="firebase-heartbeat-store";let Tt=null;function It(){return Tt||(Tt=function(t,e,{blocked:n,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(t,e),a=Z(o);return i&&o.addEventListener("upgradeneeded",(t=>{i(Z(o.result),t.oldVersion,t.newVersion,Z(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{r&&t.addEventListener("close",(()=>r())),s&&t.addEventListener("versionchange",(t=>s(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}(Ct,bt,{upgrade:(t,e)=>{0===e&&t.createObjectStore(Et)}}).catch((t=>{throw _t.create("idb-open",{originalErrorMessage:t.message})}))),Tt}async function St(t,e){try{const n=(await It()).transaction(Et,"readwrite"),i=n.objectStore(Et);await i.put(e,kt(t)),await n.done}catch(t){if(t instanceof g)lt.warn(t.message);else{const e=_t.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});lt.warn(e.message)}}}function kt(t){return`${t.name}!${t.options.appId}`}class Nt{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Rt(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),e=Pt();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==e&&!this._heartbeatsCache.heartbeats.some((t=>t.date===e)))return this._heartbeatsCache.heartbeats.push({date:e,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const t=Pt(),{heartbeatsToSend:e,unsentEntries:n}=function(t,e=1024){const n=[];let i=t.slice();for(const s of t){const t=n.find((t=>t.agent===s.agent));if(t){if(t.dates.push(s.date),xt(n)>e){t.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),xt(n)>e){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=a(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function Pt(){return(new Date).toISOString().substring(0,10)}class Rt{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(t){return!1}}()&&new Promise(((t,e)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var t;e((null===(t=s.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=await It();return await e.transaction(Et).objectStore(Et).get(kt(t))}catch(t){if(t instanceof g)lt.warn(t.message);else{const e=_t.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});lt.warn(e.message)}}}(this.app);return t||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return St(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return St(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function xt(t){return a(JSON.stringify({version:2,heartbeats:t})).length}gt(new x("platform-logger",(t=>new ot(t)),"PRIVATE")),gt(new x("heartbeat",(t=>new Nt(t)),"PRIVATE")),wt(at,ht,""),wt(at,ht,"esm2017"),wt("fire-js",""),wt("firebase","10.2.0","app");var At,Dt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Ot={},Lt=Lt||{},Mt=Dt||self;function Ft(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function qt(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Ut="closure_uid_"+(1e9*Math.random()>>>0),jt=0;function Bt(t,e,n){return t.call.apply(t.bind,arguments)}function Ht(t,e,n){if(!t)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function zt(t,e,n){return(zt=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Bt:Ht).apply(null,arguments)}function Wt(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function Vt(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(t,n,i){for(var s=Array(arguments.length-2),r=2;r<arguments.length;r++)s[r-2]=arguments[r];return e.prototype[n].apply(t,s)}}function $t(){this.s=this.s,this.o=this.o}$t.prototype.s=!1,$t.prototype.sa=function(){var t;!this.s&&(this.s=!0,this.N(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,Ut)&&t[Ut]||(t[Ut]=++jt))},$t.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Yt=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function Kt(t){const e=t.length;if(0<e){const n=Array(e);for(let i=0;i<e;i++)n[i]=t[i];return n}return[]}function Gt(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(Ft(n)){const e=t.length||0,i=n.length||0;t.length=e+i;for(let s=0;s<i;s++)t[e+s]=n[s]}else t.push(n)}}function Xt(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}Xt.prototype.h=function(){this.defaultPrevented=!0};var Qt=function(){if(!Mt.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{Mt.addEventListener("test",(()=>{}),e),Mt.removeEventListener("test",(()=>{}),e)}catch(t){}return t}();function Jt(t){return/^[\s\xa0]*$/.test(t)}function Zt(){var t=Mt.navigator;return t&&(t=t.userAgent)?t:""}function te(t){return-1!=Zt().indexOf(t)}function ee(t){return ee[" "](t),t}ee[" "]=function(){};var ne,ie,se,re=te("Opera"),oe=te("Trident")||te("MSIE"),ae=te("Edge"),he=ae||oe,le=te("Gecko")&&!(-1!=Zt().toLowerCase().indexOf("webkit")&&!te("Edge"))&&!(te("Trident")||te("MSIE"))&&!te("Edge"),ce=-1!=Zt().toLowerCase().indexOf("webkit")&&!te("Edge");function ue(){var t=Mt.document;return t?t.documentMode:void 0}t:{var de="",pe=(ie=Zt(),le?/rv:([^\);]+)(\)|;)/.exec(ie):ae?/Edge\/([\d\.]+)/.exec(ie):oe?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ie):ce?/WebKit\/(\S+)/.exec(ie):re?/(?:Version)[ \/]?(\S+)/.exec(ie):void 0);if(pe&&(de=pe?pe[1]:""),oe){var fe=ue();if(null!=fe&&fe>parseFloat(de)){ne=String(fe);break t}}ne=de}Mt.document&&oe?se=ue()||parseInt(ne,10)||void 0:se=void 0;var ge=se;function _e(t,e){if(Xt.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,i=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(le){t:{try{ee(e.nodeName);var s=!0;break t}catch(t){}s=!1}s||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:me[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&_e.$.h.call(this)}}Vt(_e,Xt);var me={2:"touch",3:"pen",4:"mouse"};_e.prototype.h=function(){_e.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var ye="closure_listenable_"+(1e6*Math.random()|0),ve=0;function we(t,e,n,i,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!i,this.la=s,this.key=++ve,this.fa=this.ia=!1}function Ce(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function be(t,e,n){for(const i in t)e.call(n,t[i],i,t)}function Ee(t){const e={};for(const n in t)e[n]=t[n];return e}const Te="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ie(t,e){let n,i;for(let e=1;e<arguments.length;e++){for(n in i=arguments[e],i)t[n]=i[n];for(let e=0;e<Te.length;e++)n=Te[e],Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}}function Se(t){this.src=t,this.g={},this.h=0}function ke(t,e){var n=e.type;if(n in t.g){var i,s=t.g[n],r=Yt(s,e);(i=0<=r)&&Array.prototype.splice.call(s,r,1),i&&(Ce(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function Ne(t,e,n,i){for(var s=0;s<t.length;++s){var r=t[s];if(!r.fa&&r.listener==e&&r.capture==!!n&&r.la==i)return s}return-1}Se.prototype.add=function(t,e,n,i,s){var r=t.toString();(t=this.g[r])||(t=this.g[r]=[],this.h++);var o=Ne(t,e,i,s);return-1<o?(e=t[o],n||(e.ia=!1)):((e=new we(e,this.src,r,!!i,s)).ia=n,t.push(e)),e};var Pe="closure_lm_"+(1e6*Math.random()|0),Re={};function xe(t,e,n,i,s){if(i&&i.once)return De(t,e,n,i,s);if(Array.isArray(e)){for(var r=0;r<e.length;r++)xe(t,e[r],n,i,s);return null}return n=je(n),t&&t[ye]?t.O(e,n,qt(i)?!!i.capture:!!i,s):Ae(t,e,n,!1,i,s)}function Ae(t,e,n,i,s,r){if(!e)throw Error("Invalid event type");var o=qt(s)?!!s.capture:!!s,a=qe(t);if(a||(t[Pe]=a=new Se(t)),(n=a.add(e,n,i,o,r)).proxy)return n;if(i=function(){const t=Fe;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=i,i.src=t,i.listener=n,t.addEventListener)Qt||(s=o),void 0===s&&(s=!1),t.addEventListener(e.toString(),i,s);else if(t.attachEvent)t.attachEvent(Me(e.toString()),i);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(i)}return n}function De(t,e,n,i,s){if(Array.isArray(e)){for(var r=0;r<e.length;r++)De(t,e[r],n,i,s);return null}return n=je(n),t&&t[ye]?t.P(e,n,qt(i)?!!i.capture:!!i,s):Ae(t,e,n,!0,i,s)}function Oe(t,e,n,i,s){if(Array.isArray(e))for(var r=0;r<e.length;r++)Oe(t,e[r],n,i,s);else i=qt(i)?!!i.capture:!!i,n=je(n),t&&t[ye]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=Ne(r=t.g[e],n,i,s))&&(Ce(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete t.g[e],t.h--))):t&&(t=qe(t))&&(e=t.g[e.toString()],t=-1,e&&(t=Ne(e,n,i,s)),(n=-1<t?e[t]:null)&&Le(n))}function Le(t){if("number"!=typeof t&&t&&!t.fa){var e=t.src;if(e&&e[ye])ke(e.i,t);else{var n=t.type,i=t.proxy;e.removeEventListener?e.removeEventListener(n,i,t.capture):e.detachEvent?e.detachEvent(Me(n),i):e.addListener&&e.removeListener&&e.removeListener(i),(n=qe(e))?(ke(n,t),0==n.h&&(n.src=null,e[Pe]=null)):Ce(t)}}}function Me(t){return t in Re?Re[t]:Re[t]="on"+t}function Fe(t,e){if(t.fa)t=!0;else{e=new _e(e,this);var n=t.listener,i=t.la||t.src;t.ia&&Le(t),t=n.call(i,e)}return t}function qe(t){return(t=t[Pe])instanceof Se?t:null}var Ue="__closure_events_fn_"+(1e9*Math.random()>>>0);function je(t){return"function"==typeof t?t:(t[Ue]||(t[Ue]=function(e){return t.handleEvent(e)}),t[Ue])}function Be(){$t.call(this),this.i=new Se(this),this.S=this,this.J=null}function He(t,e){var n,i=t.J;if(i)for(n=[];i;i=i.J)n.push(i);if(t=t.S,i=e.type||e,"string"==typeof e)e=new Xt(e,t);else if(e instanceof Xt)e.target=e.target||t;else{var s=e;Ie(e=new Xt(i,t),s)}if(s=!0,n)for(var r=n.length-1;0<=r;r--){var o=e.g=n[r];s=ze(o,i,!0,e)&&s}if(s=ze(o=e.g=t,i,!0,e)&&s,s=ze(o,i,!1,e)&&s,n)for(r=0;r<n.length;r++)s=ze(o=e.g=n[r],i,!1,e)&&s}function ze(t,e,n,i){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,r=0;r<e.length;++r){var o=e[r];if(o&&!o.fa&&o.capture==n){var a=o.listener,h=o.la||o.src;o.ia&&ke(t.i,o),s=!1!==a.call(h,i)&&s}}return s&&!i.defaultPrevented}Vt(Be,$t),Be.prototype[ye]=!0,Be.prototype.removeEventListener=function(t,e,n,i){Oe(this,t,e,n,i)},Be.prototype.N=function(){if(Be.$.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],i=0;i<n.length;i++)Ce(n[i]);delete e.g[t],e.h--}}this.J=null},Be.prototype.O=function(t,e,n,i){return this.i.add(String(t),e,!1,n,i)},Be.prototype.P=function(t,e,n,i){return this.i.add(String(t),e,!0,n,i)};var We=Mt.JSON.stringify;function Ve(){var t=Je;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var $e=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new Ye),(t=>t.reset()));class Ye{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Ke(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function Ge(t){Mt.setTimeout((()=>{throw t}),0)}let Xe,Qe=!1,Je=new class{constructor(){this.h=this.g=null}add(t,e){const n=$e.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},Ze=()=>{const t=Mt.Promise.resolve(void 0);Xe=()=>{t.then(tn)}};var tn=()=>{for(var t;t=Ve();){try{t.h.call(t.g)}catch(t){Ge(t)}var e=$e;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Qe=!1};function en(t,e){Be.call(this),this.h=t||1,this.g=e||Mt,this.j=zt(this.qb,this),this.l=Date.now()}function nn(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}function sn(t,e,n){if("function"==typeof t)n&&(t=zt(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=zt(t.handleEvent,t)}return 2147483647<Number(e)?-1:Mt.setTimeout(t,e||0)}function rn(t){t.g=sn((()=>{t.g=null,t.i&&(t.i=!1,rn(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}Vt(en,Be),(At=en.prototype).ga=!1,At.T=null,At.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),He(this,"tick"),this.ga&&(nn(this),this.start()))}},At.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},At.N=function(){en.$.N.call(this),nn(this),delete this.g};class on extends $t{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:rn(this)}N(){super.N(),this.g&&(Mt.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function an(t){$t.call(this),this.h=t,this.g={}}Vt(an,$t);var hn=[];function ln(t,e,n,i){Array.isArray(n)||(n&&(hn[0]=n.toString()),n=hn);for(var s=0;s<n.length;s++){var r=xe(e,n[s],i||t.handleEvent,!1,t.h||t);if(!r)break;t.g[r.key]=r}}function cn(t){be(t.g,(function(t,e){this.g.hasOwnProperty(e)&&Le(t)}),t),t.g={}}function un(){this.g=!0}function dn(t,e,n,i){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var i=n[t];if(!(2>i.length)){var s=i[1];if(Array.isArray(s)&&!(1>s.length)){var r=s[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<s.length;o++)s[o]=""}}}return We(n)}catch(t){return e}}(t,n)+(i?" "+i:"")}))}an.prototype.N=function(){an.$.N.call(this),cn(this)},an.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},un.prototype.Ea=function(){this.g=!1},un.prototype.info=function(){};var pn={},fn=null;function gn(){return fn=fn||new Be}function _n(t){Xt.call(this,pn.Ta,t)}function mn(t){const e=gn();He(e,new _n(e))}function yn(t,e){Xt.call(this,pn.STAT_EVENT,t),this.stat=e}function vn(t){const e=gn();He(e,new yn(e,t))}function wn(t,e){Xt.call(this,pn.Ua,t),this.size=e}function Cn(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return Mt.setTimeout((function(){t()}),e)}pn.Ta="serverreachability",Vt(_n,Xt),pn.STAT_EVENT="statevent",Vt(yn,Xt),pn.Ua="timingevent",Vt(wn,Xt);var bn={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},En={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Tn(){}function In(t){return t.h||(t.h=t.i())}function Sn(){}Tn.prototype.h=null;var kn,Nn={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Pn(){Xt.call(this,"d")}function Rn(){Xt.call(this,"c")}function xn(){}function An(t,e,n,i){this.l=t,this.j=e,this.m=n,this.W=i||1,this.U=new an(this),this.P=On,t=he?125:void 0,this.V=new en(t),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Dn}function Dn(){this.i=null,this.g="",this.h=!1}Vt(Pn,Xt),Vt(Rn,Xt),Vt(xn,Tn),xn.prototype.g=function(){return new XMLHttpRequest},xn.prototype.i=function(){return{}},kn=new xn;var On=45e3,Ln={},Mn={};function Fn(t,e,n){t.L=1,t.v=ni(Qn(e)),t.s=n,t.S=!0,qn(t,null)}function qn(t,e){t.G=Date.now(),Hn(t),t.A=Qn(t.v);var n=t.A,i=t.W;Array.isArray(i)||(i=[String(i)]),gi(n.i,"t",i),t.C=0,n=t.l.J,t.h=new Dn,t.g=fs(t.l,n?e:null,!t.s),0<t.O&&(t.M=new on(zt(t.Pa,t,t.g),t.O)),ln(t.U,t.g,"readystatechange",t.nb),e=t.I?Ee(t.I):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.A,t.u,t.s,e)):(t.u="GET",t.g.ha(t.A,t.u,null,e)),mn(),function(t,e,n,i,s,r){t.info((function(){if(t.g)if(r)for(var o="",a=r.split("&"),h=0;h<a.length;h++){var l=a[h].split("=");if(1<l.length){var c=l[0];l=l[1];var u=c.split("_");o=2<=u.length&&"type"==u[1]?o+(c+"=")+l+"&":o+(c+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+i+") [attempt "+s+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.u,t.A,t.m,t.W,t.s)}function Un(t){return!!t.g&&"GET"==t.u&&2!=t.L&&t.l.Ha}function jn(t,e,n){let i,s=!0;for(;!t.J&&t.C<n.length;){if(i=Bn(t,n),i==Mn){4==e&&(t.o=4,vn(14),s=!1),dn(t.j,t.m,null,"[Incomplete Response]");break}if(i==Ln){t.o=4,vn(15),dn(t.j,t.m,n,"[Invalid Chunk]"),s=!1;break}dn(t.j,t.m,i,null),Yn(t,i)}Un(t)&&i!=Mn&&i!=Ln&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,vn(16),s=!1),t.i=t.i&&s,s?0<n.length&&!t.ba&&(t.ba=!0,(e=t.l).g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),os(e),e.M=!0,vn(11))):(dn(t.j,t.m,n,"[Invalid Chunked Response]"),$n(t),Vn(t))}function Bn(t,e){var n=t.C,i=e.indexOf("\n",n);return-1==i?Mn:(n=Number(e.substring(n,i)),isNaN(n)?Ln:(i+=1)+n>e.length?Mn:(e=e.slice(i,i+n),t.C=i+n,e))}function Hn(t){t.Y=Date.now()+t.P,zn(t,t.P)}function zn(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Cn(zt(t.lb,t),e)}function Wn(t){t.B&&(Mt.clearTimeout(t.B),t.B=null)}function Vn(t){0==t.l.H||t.J||ls(t.l,t)}function $n(t){Wn(t);var e=t.M;e&&"function"==typeof e.sa&&e.sa(),t.M=null,nn(t.V),cn(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function Yn(t,e){try{var n=t.l;if(0!=n.H&&(n.g==t||Ci(n.i,t)))if(!t.K&&Ci(n.i,t)&&3==n.H){try{var i=n.Ja.g.parse(e)}catch(t){i=null}if(Array.isArray(i)&&3==i.length){var s=i;if(0==s[0]){t:if(!n.u){if(n.g){if(!(n.g.G+3e3<t.G))break t;hs(n),Ji(n)}rs(n),vn(18)}}else n.Fa=s[1],0<n.Fa-n.V&&37500>s[2]&&n.G&&0==n.A&&!n.v&&(n.v=Cn(zt(n.ib,n),6e3));if(1>=wi(n.i)&&n.oa){try{n.oa()}catch(t){}n.oa=void 0}}else us(n,11)}else if((t.K||n.g==t)&&hs(n),!Jt(e))for(s=n.Ja.g.parse(e),e=0;e<s.length;e++){let l=s[e];if(n.V=l[0],l=l[1],2==n.H)if("c"==l[0]){n.K=l[1],n.pa=l[2];const e=l[3];null!=e&&(n.ra=e,n.l.info("VER="+n.ra));const s=l[4];null!=s&&(n.Ga=s,n.l.info("SVER="+n.Ga));const c=l[5];null!=c&&"number"==typeof c&&0<c&&(i=1.5*c,n.L=i,n.l.info("backChannelRequestTimeoutMs_="+i)),i=n;const u=t.g;if(u){const t=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var r=i.i;r.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(r.j=r.l,r.g=new Set,r.h&&(bi(r,r.h),r.h=null))}if(i.F){const t=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(i.Da=t,ei(i.I,i.F,t))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=t;if((i=n).wa=ps(i,i.J?i.pa:null,i.Y),o.K){Ei(i.i,o);var a=o,h=i.L;h&&a.setTimeout(h),a.B&&(Wn(a),Hn(a)),i.g=o}else ss(i);0<n.j.length&&ts(n)}else"stop"!=l[0]&&"close"!=l[0]||us(n,7);else 3==n.H&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?us(n,7):Qi(n):"noop"!=l[0]&&n.h&&n.h.Aa(l),n.A=0)}mn()}catch(t){}}function Kn(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(Ft(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.ta&&"function"==typeof t.ta)return t.ta();if(!t.Z||"function"!=typeof t.Z){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(Ft(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const i in t)e[n++]=i;return e}}}(t),i=function(t){if(t.Z&&"function"==typeof t.Z)return t.Z();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(Ft(t)){for(var e=[],n=t.length,i=0;i<n;i++)e.push(t[i]);return e}for(i in e=[],n=0,t)e[n++]=t[i];return e}(t),s=i.length,r=0;r<s;r++)e.call(void 0,i[r],n&&n[r],t)}(At=An.prototype).setTimeout=function(t){this.P=t},At.nb=function(t){t=t.target;const e=this.M;e&&3==Vi(t)?e.l():this.Pa(t)},At.Pa=function(t){try{if(t==this.g)t:{const c=Vi(this.g);var e=this.g.Ia();if(this.g.da(),!(3>c)&&(3!=c||he||this.g&&(this.h.h||this.g.ja()||$i(this.g)))){this.J||4!=c||7==e||mn(),Wn(this);var n=this.g.da();this.ca=n;e:if(Un(this)){var i=$i(this.g);t="";var s=i.length,r=4==Vi(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){$n(this),Vn(this);var o="";break e}this.h.i=new Mt.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(i[e],{stream:r&&e==s-1});i.splice(0,s),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(t,e,n,i,s,r,o){t.info((function(){return"XMLHTTP RESP ("+i+") [ attempt "+s+"]: "+e+"\n"+n+"\n"+r+" "+o}))}(this.j,this.u,this.A,this.m,this.W,c,n),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,h=this.g;if((a=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Jt(a)){var l=a;break e}}l=null}if(!(n=l)){this.i=!1,this.o=3,vn(12),$n(this),Vn(this);break t}dn(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Yn(this,n)}this.S?(jn(this,c,o),he&&this.i&&3==c&&(ln(this.U,this.V,"tick",this.mb),this.V.start())):(dn(this.j,this.m,o,null),Yn(this,o)),4==c&&$n(this),this.i&&!this.J&&(4==c?ls(this.l,this):(this.i=!1,Hn(this)))}else(function(t){const e={};t=(t.g&&2<=Vi(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let i=0;i<t.length;i++){if(Jt(t[i]))continue;var n=Ke(t[i]);const s=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const r=e[s]||[];e[s]=r,r.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.o=3,vn(12)):(this.o=0,vn(13)),$n(this),Vn(this)}}}catch(t){}},At.mb=function(){if(this.g){var t=Vi(this.g),e=this.g.ja();this.C<e.length&&(Wn(this),jn(this,t,e),this.i&&4!=t&&Hn(this))}},At.cancel=function(){this.J=!0,$n(this)},At.lb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.L&&(mn(),vn(17)),$n(this),this.o=2,Vn(this)):zn(this,this.Y-t)};var Gn=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Xn(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Xn){this.h=t.h,Jn(this,t.j),this.s=t.s,this.g=t.g,Zn(this,t.m),this.l=t.l;var e=t.i,n=new ui;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),ti(this,n),this.o=t.o}else t&&(e=String(t).match(Gn))?(this.h=!1,Jn(this,e[1]||"",!0),this.s=ii(e[2]||""),this.g=ii(e[3]||"",!0),Zn(this,e[4]),this.l=ii(e[5]||"",!0),ti(this,e[6]||"",!0),this.o=ii(e[7]||"")):(this.h=!1,this.i=new ui(null,this.h))}function Qn(t){return new Xn(t)}function Jn(t,e,n){t.j=n?ii(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Zn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function ti(t,e,n){e instanceof ui?(t.i=e,function(t,e){e&&!t.j&&(di(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(pi(this,e),gi(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=si(e,li)),t.i=new ui(e,t.h))}function ei(t,e,n){t.i.set(e,n)}function ni(t){return ei(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function ii(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function si(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,ri),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function ri(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Xn.prototype.toString=function(){var t=[],e=this.j;e&&t.push(si(e,oi,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(si(e,oi,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(si(n,"/"==n.charAt(0)?hi:ai,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",si(n,ci)),t.join("")};var oi=/[#\/\?@]/g,ai=/[#\?:]/g,hi=/[#\?]/g,li=/[#\?@]/g,ci=/#/g;function ui(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function di(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var i=t[n].indexOf("="),s=null;if(0<=i){var r=t[n].substring(0,i);s=t[n].substring(i+1)}else r=t[n];e(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function pi(t,e){di(t),e=_i(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function fi(t,e){return di(t),e=_i(t,e),t.g.has(e)}function gi(t,e,n){pi(t,e),0<n.length&&(t.i=null,t.g.set(_i(t,e),Kt(n)),t.h+=n.length)}function _i(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function mi(t){this.l=t||yi,t=Mt.PerformanceNavigationTiming?0<(t=Mt.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(Mt.g&&Mt.g.Ka&&Mt.g.Ka()&&Mt.g.Ka().ec),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(At=ui.prototype).add=function(t,e){di(this),this.i=null,t=_i(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},At.forEach=function(t,e){di(this),this.g.forEach((function(n,i){n.forEach((function(n){t.call(e,n,i,this)}),this)}),this)},At.ta=function(){di(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let i=0;i<e.length;i++){const s=t[i];for(let t=0;t<s.length;t++)n.push(e[i])}return n},At.Z=function(t){di(this);let e=[];if("string"==typeof t)fi(this,t)&&(e=e.concat(this.g.get(_i(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},At.set=function(t,e){return di(this),this.i=null,fi(this,t=_i(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},At.get=function(t,e){return t&&0<(t=this.Z(t)).length?String(t[0]):e},At.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var i=e[n];const r=encodeURIComponent(String(i)),o=this.Z(i);for(i=0;i<o.length;i++){var s=r;""!==o[i]&&(s+="="+encodeURIComponent(String(o[i]))),t.push(s)}}return this.i=t.join("&")};var yi=10;function vi(t){return!!t.h||!!t.g&&t.g.size>=t.j}function wi(t){return t.h?1:t.g?t.g.size:0}function Ci(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function bi(t,e){t.g?t.g.add(e):t.h=e}function Ei(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Ti(t){if(null!=t.h)return t.i.concat(t.h.F);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}return Kt(t.i)}mi.prototype.cancel=function(){if(this.i=Ti(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var Ii=class{stringify(t){return Mt.JSON.stringify(t,void 0)}parse(t){return Mt.JSON.parse(t,void 0)}};function Si(){this.g=new Ii}function ki(t,e,n){const i=n||"";try{Kn(t,(function(t,n){let s=t;qt(t)&&(s=We(t)),e.push(i+n+"="+encodeURIComponent(s))}))}catch(t){throw e.push(i+"type="+encodeURIComponent("_badmap")),t}}function Ni(t,e,n,i,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(i)}catch(t){}}function Pi(t){this.l=t.fc||null,this.j=t.ob||!1}function Ri(t,e){Be.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=xi,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Vt(Pi,Tn),Pi.prototype.g=function(){return new Ri(this.l,this.j)},Pi.prototype.i=function(t){return function(){return t}}({}),Vt(Ri,Be);var xi=0;function Ai(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}function Di(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Oi(t)}function Oi(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(At=Ri.prototype).open=function(t,e){if(this.readyState!=xi)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Oi(this)},At.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||Mt).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},At.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Di(this)),this.readyState=xi},At.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Oi(this)),this.g&&(this.readyState=3,Oi(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==Mt.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Ai(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))},At.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Di(this):Oi(this),3==this.readyState&&Ai(this)}},At.Za=function(t){this.g&&(this.response=this.responseText=t,Di(this))},At.Ya=function(t){this.g&&(this.response=t,Di(this))},At.ka=function(){this.g&&Di(this)},At.setRequestHeader=function(t,e){this.v.append(t,e)},At.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},At.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Ri.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Li=Mt.JSON.parse;function Mi(t){Be.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Fi,this.L=this.M=!1}Vt(Mi,Be);var Fi="",qi=/^https?$/i,Ui=["POST","PUT"];function ji(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Bi(t),zi(t)}function Bi(t){t.F||(t.F=!0,He(t,"complete"),He(t,"error"))}function Hi(t){if(t.h&&void 0!==Lt&&(!t.C[1]||4!=Vi(t)||2!=t.da()))if(t.v&&4==Vi(t))sn(t.La,0,t);else if(He(t,"readystatechange"),4==Vi(t)){t.h=!1;try{const o=t.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var i;if(i=0===o){var s=String(t.I).match(Gn)[1]||null;!s&&Mt.self&&Mt.self.location&&(s=Mt.self.location.protocol.slice(0,-1)),i=!qi.test(s?s.toLowerCase():"")}n=i}if(n)He(t,"complete"),He(t,"success");else{t.m=6;try{var r=2<Vi(t)?t.g.statusText:""}catch(t){r=""}t.j=r+" ["+t.da()+"]",Bi(t)}}finally{zi(t)}}}function zi(t,e){if(t.g){Wi(t);const n=t.g,i=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||He(t,"ready");try{n.onreadystatechange=i}catch(t){}}}function Wi(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(Mt.clearTimeout(t.A),t.A=null)}function Vi(t){return t.g?t.g.readyState:0}function $i(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case Fi:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Yi(t){let e="";return be(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function Ki(t,e,n){t:{for(i in n){var i=!1;break t}i=!0}i||(n=Yi(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):ei(t,e,n))}function Gi(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Xi(t){this.Ga=0,this.j=[],this.l=new un,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Gi("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Gi("baseRetryDelayMs",5e3,t),this.hb=Gi("retryDelaySeedMs",1e4,t),this.eb=Gi("forwardChannelMaxRetries",2,t),this.xa=Gi("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.dc||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new mi(t&&t.concurrentRequestLimit),this.Ja=new Si,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Qi(t){if(Zi(t),3==t.H){var e=t.W++,n=Qn(t.I);if(ei(n,"SID",t.K),ei(n,"RID",e),ei(n,"TYPE","terminate"),ns(t,n),(e=new An(t,t.l,e)).L=2,e.v=ni(Qn(n)),n=!1,Mt.navigator&&Mt.navigator.sendBeacon)try{n=Mt.navigator.sendBeacon(e.v.toString(),"")}catch(t){}!n&&Mt.Image&&((new Image).src=e.v,n=!0),n||(e.g=fs(e.l,null),e.g.ha(e.v)),e.G=Date.now(),Hn(e)}ds(t)}function Ji(t){t.g&&(os(t),t.g.cancel(),t.g=null)}function Zi(t){Ji(t),t.u&&(Mt.clearTimeout(t.u),t.u=null),hs(t),t.i.cancel(),t.m&&("number"==typeof t.m&&Mt.clearTimeout(t.m),t.m=null)}function ts(t){if(!vi(t.i)&&!t.m){t.m=!0;var e=t.Na;Xe||Ze(),Qe||(Xe(),Qe=!0),Je.add(e,t),t.C=0}}function es(t,e){var n;n=e?e.m:t.W++;const i=Qn(t.I);ei(i,"SID",t.K),ei(i,"RID",n),ei(i,"AID",t.V),ns(t,i),t.o&&t.s&&Ki(i,t.o,t.s),n=new An(t,t.l,n,t.C+1),null===t.o&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=is(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),bi(t.i,n),Fn(n,i,e)}function ns(t,e){t.na&&be(t.na,(function(t,n){ei(e,n,t)})),t.h&&Kn({},(function(t,n){ei(e,n,t)}))}function is(t,e,n){n=Math.min(t.j.length,n);var i=t.h?zt(t.h.Va,t.h,t):null;t:{var s=t.j;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=s[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let r=!0;for(let o=0;o<n;o++){let n=s[o].g;const a=s[o].map;if(n-=e,0>n)e=Math.max(0,s[o].g-100),r=!1;else try{ki(a,t,"req"+n+"_")}catch(t){i&&i(a)}}if(r){i=t.join("&");break t}}}return t=t.j.splice(0,n),e.F=t,i}function ss(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;Xe||Ze(),Qe||(Xe(),Qe=!0),Je.add(e,t),t.A=0}}function rs(t){return!(t.g||t.u||3<=t.A||(t.ba++,t.u=Cn(zt(t.Ma,t),cs(t,t.A)),t.A++,0))}function os(t){null!=t.B&&(Mt.clearTimeout(t.B),t.B=null)}function as(t){t.g=new An(t,t.l,"rpc",t.ba),null===t.o&&(t.g.I=t.s),t.g.O=0;var e=Qn(t.wa);ei(e,"RID","rpc"),ei(e,"SID",t.K),ei(e,"AID",t.V),ei(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&ei(e,"TO",t.qa),ei(e,"TYPE","xmlhttp"),ns(t,e),t.o&&t.s&&Ki(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.v=ni(Qn(e)),n.s=null,n.S=!0,qn(n,t)}function hs(t){null!=t.v&&(Mt.clearTimeout(t.v),t.v=null)}function ls(t,e){var n=null;if(t.g==e){hs(t),os(t),t.g=null;var i=2}else{if(!Ci(t.i,e))return;n=e.F,Ei(t.i,e),i=1}if(0!=t.H)if(e.i)if(1==i){n=e.s?e.s.length:0,e=Date.now()-e.G;var s=t.C;He(i=gn(),new wn(i,n)),ts(t)}else ss(t);else if(3==(s=e.o)||0==s&&0<e.ca||!(1==i&&function(t,e){return!(wi(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.j=e.F.concat(t.j),0):1==t.H||2==t.H||t.C>=(t.cb?0:t.eb)||(t.m=Cn(zt(t.Na,t,e),cs(t,t.C)),t.C++,0)))}(t,e)||2==i&&rs(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),s){case 1:us(t,5);break;case 4:us(t,10);break;case 3:us(t,6);break;default:us(t,2)}}function cs(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function us(t,e){if(t.l.info("Error code "+e),2==e){var n=null;t.h&&(n=null);var i=zt(t.pb,t);n||(n=new Xn("//www.google.com/images/cleardot.gif"),Mt.location&&"http"==Mt.location.protocol||Jn(n,"https"),ni(n)),function(t,e){const n=new un;if(Mt.Image){const i=new Image;i.onload=Wt(Ni,n,i,"TestLoadImage: loaded",!0,e),i.onerror=Wt(Ni,n,i,"TestLoadImage: error",!1,e),i.onabort=Wt(Ni,n,i,"TestLoadImage: abort",!1,e),i.ontimeout=Wt(Ni,n,i,"TestLoadImage: timeout",!1,e),Mt.setTimeout((function(){i.ontimeout&&i.ontimeout()}),1e4),i.src=t}else e(!1)}(n.toString(),i)}else vn(2);t.H=0,t.h&&t.h.za(e),ds(t),Zi(t)}function ds(t){if(t.H=0,t.ma=[],t.h){const e=Ti(t.i);0==e.length&&0==t.j.length||(Gt(t.ma,e),Gt(t.ma,t.j),t.i.i.length=0,Kt(t.j),t.j.length=0),t.h.ya()}}function ps(t,e,n){var i=n instanceof Xn?Qn(n):new Xn(n);if(""!=i.g)e&&(i.g=e+"."+i.g),Zn(i,i.m);else{var s=Mt.location;i=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;var r=new Xn(null);i&&Jn(r,i),e&&(r.g=e),s&&Zn(r,s),n&&(r.l=n),i=r}return n=t.F,e=t.Da,n&&e&&ei(i,n,e),ei(i,"VER",t.ra),ns(t,i),i}function fs(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ha&&!t.va?new Mi(new Pi({ob:!0})):new Mi(t.va)).Oa(t.J),e}function gs(){}function _s(){if(oe&&!(10<=Number(ge)))throw Error("Environmental error: no available transport.")}function ms(t,e){Be.call(this),this.g=new Xi(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!Jt(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Jt(e)&&(this.g.F=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new ws(this)}function ys(t){Pn.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function vs(){Rn.call(this),this.status=1}function ws(t){this.g=t}function Cs(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function bs(t,e,n){n||(n=0);var i=Array(16);if("string"==typeof e)for(var s=0;16>s;++s)i[s]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(s=0;16>s;++s)i[s]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],s=t.g[2];var r=t.g[3],o=e+(r^n&(s^r))+i[0]+3614090360&4294967295;o=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=(n=(s=(r=(e=n+(o<<7&4294967295|o>>>25))+((o=r+(s^e&(n^s))+i[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^r&(e^n))+i[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(r^e))+i[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(r^n&(s^r))+i[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=r+(s^e&(n^s))+i[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^r&(e^n))+i[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(r^e))+i[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(r^n&(s^r))+i[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=r+(s^e&(n^s))+i[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^r&(e^n))+i[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(r^e))+i[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(r^n&(s^r))+i[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=r+(s^e&(n^s))+i[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^r&(e^n))+i[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(r^e))+i[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^r&(n^s))+i[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^s&(e^n))+i[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(r^e))+i[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^e&(s^r))+i[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^r&(n^s))+i[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^s&(e^n))+i[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(r^e))+i[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^e&(s^r))+i[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^r&(n^s))+i[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^s&(e^n))+i[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(r^e))+i[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^e&(s^r))+i[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^r&(n^s))+i[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^s&(e^n))+i[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(r^e))+i[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^e&(s^r))+i[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^s^r)+i[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=r+(e^n^s)+i[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=s+(r^e^n)+i[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^r^e)+i[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^r)+i[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=r+(e^n^s)+i[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=s+(r^e^n)+i[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^r^e)+i[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^r)+i[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=r+(e^n^s)+i[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=s+(r^e^n)+i[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^r^e)+i[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^r)+i[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=r+(e^n^s)+i[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=s+(r^e^n)+i[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^r^e)+i[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(s^(n|~r))+i[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(e|~s))+i[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(r|~n))+i[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(s|~e))+i[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(s^(n|~r))+i[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(e|~s))+i[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(r|~n))+i[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(s|~e))+i[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(s^(n|~r))+i[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(e|~s))+i[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(r|~n))+i[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(s|~e))+i[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((r=(e=n+((o=e+(s^(n|~r))+i[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(e|~s))+i[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((s=r+((o=s+(e^(r|~n))+i[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+i[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(s+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+s&4294967295,t.g[3]=t.g[3]+r&4294967295}function Es(t,e){this.h=e;for(var n=[],i=!0,s=t.length-1;0<=s;s--){var r=0|t[s];i&&r==e||(n[s]=r,i=!1)}this.g=n}(At=Mi.prototype).Oa=function(t){this.M=t},At.ha=function(t,e,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():kn.g(),this.C=this.u?In(this.u):In(kn),this.g.onreadystatechange=zt(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(t){return void ji(this,t)}if(t=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)n.set(s,i[s]);else{if("function"!=typeof i.keys||"function"!=typeof i.get)throw Error("Unknown input type for opt_headers: "+String(i));for(const t of i.keys())n.set(t,i.get(t))}i=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),s=Mt.FormData&&t instanceof Mt.FormData,!(0<=Yt(Ui,e))||i||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Wi(this),0<this.B&&((this.L=function(t){return oe&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=zt(this.ua,this)):this.A=sn(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){ji(this,t)}},At.ua=function(){void 0!==Lt&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,He(this,"timeout"),this.abort(8))},At.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,He(this,"complete"),He(this,"abort"),zi(this))},At.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),zi(this,!0)),Mi.$.N.call(this)},At.La=function(){this.s||(this.G||this.v||this.l?Hi(this):this.kb())},At.kb=function(){Hi(this)},At.isActive=function(){return!!this.g},At.da=function(){try{return 2<Vi(this)?this.g.status:-1}catch(t){return-1}},At.ja=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},At.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Li(e)}},At.Ia=function(){return this.m},At.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(At=Xi.prototype).ra=8,At.H=1,At.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const s=new An(this,this.l,t);let r=this.s;if(this.U&&(r?(r=Ee(r),Ie(r,this.U)):r=this.U),null!==this.o||this.O||(s.I=r,r=null),this.P)t:{for(var e=0,n=0;n<this.j.length;n++){var i=this.j[n];if(void 0===(i="__data__"in i.map&&"string"==typeof(i=i.map.__data__)?i.length:void 0))break;if(4096<(e+=i)){e=n;break t}if(4096===e||n===this.j.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=is(this,s,e),ei(n=Qn(this.I),"RID",t),ei(n,"CVER",22),this.F&&ei(n,"X-HTTP-Session-Id",this.F),ns(this,n),r&&(this.O?e="headers="+encodeURIComponent(String(Yi(r)))+"&"+e:this.o&&Ki(n,this.o,r)),bi(this.i,s),this.bb&&ei(n,"TYPE","init"),this.P?(ei(n,"$req",e),ei(n,"SID","null"),s.aa=!0,Fn(s,n,null)):Fn(s,n,e),this.H=2}}else 3==this.H&&(t?es(this,t):0==this.j.length||vi(this.i)||es(this))},At.Ma=function(){if(this.u=null,as(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=Cn(zt(this.jb,this),t)}},At.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,vn(10),Ji(this),as(this))},At.ib=function(){null!=this.v&&(this.v=null,Ji(this),rs(this),vn(19))},At.pb=function(t){t?(this.l.info("Successfully pinged google.com"),vn(2)):(this.l.info("Failed to ping google.com"),vn(1))},At.isActive=function(){return!!this.h&&this.h.isActive(this)},(At=gs.prototype).Ba=function(){},At.Aa=function(){},At.za=function(){},At.ya=function(){},At.isActive=function(){return!0},At.Va=function(){},_s.prototype.g=function(t,e){return new ms(t,e)},Vt(ms,Be),ms.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;vn(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=ps(t,null,t.Y),ts(t)},ms.prototype.close=function(){Qi(this.g)},ms.prototype.u=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=We(t),t=n);e.j.push(new class{constructor(t,e){this.g=t,this.map=e}}(e.fb++,t)),3==e.H&&ts(e)},ms.prototype.N=function(){this.g.h=null,delete this.j,Qi(this.g),delete this.g,ms.$.N.call(this)},Vt(ys,Pn),Vt(vs,Rn),Vt(ws,gs),ws.prototype.Ba=function(){He(this.g,"a")},ws.prototype.Aa=function(t){He(this.g,new ys(t))},ws.prototype.za=function(t){He(this.g,new vs)},ws.prototype.ya=function(){He(this.g,"b")},Vt(Cs,(function(){this.blockSize=-1})),Cs.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Cs.prototype.j=function(t,e){void 0===e&&(e=t.length);for(var n=e-this.blockSize,i=this.m,s=this.h,r=0;r<e;){if(0==s)for(;r<=n;)bs(this,t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[s++]=t.charCodeAt(r++),s==this.blockSize){bs(this,i),s=0;break}}else for(;r<e;)if(i[s++]=t[r++],s==this.blockSize){bs(this,i),s=0;break}}this.h=s,this.i+=e},Cs.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var i=0;32>i;i+=8)t[n++]=this.g[e]>>>i&255;return t};var Ts={};function Is(t){return-128<=t&&128>t?function(t,e){var n=Ts;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=function(t){return new Es([0|t],0>t?-1:0)}(t)}(t):new Es([0|t],0>t?-1:0)}function Ss(t){if(isNaN(t)||!isFinite(t))return Ns;if(0>t)return Ds(Ss(-t));for(var e=[],n=1,i=0;t>=n;i++)e[i]=t/n|0,n*=ks;return new Es(e,0)}var ks=4294967296,Ns=Is(0),Ps=Is(1),Rs=Is(16777216);function xs(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function As(t){return-1==t.h}function Ds(t){for(var e=t.g.length,n=[],i=0;i<e;i++)n[i]=~t.g[i];return new Es(n,~t.h).add(Ps)}function Os(t,e){return t.add(Ds(e))}function Ls(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function Ms(t,e){this.g=t,this.h=e}function Fs(t,e){if(xs(e))throw Error("division by zero");if(xs(t))return new Ms(Ns,Ns);if(As(t))return e=Fs(Ds(t),e),new Ms(Ds(e.g),Ds(e.h));if(As(e))return e=Fs(t,Ds(e)),new Ms(Ds(e.g),e.h);if(30<t.g.length){if(As(t)||As(e))throw Error("slowDivide_ only works with positive integers.");for(var n=Ps,i=e;0>=i.X(t);)n=qs(n),i=qs(i);var s=Us(n,1),r=Us(i,1);for(i=Us(i,2),n=Us(n,2);!xs(i);){var o=r.add(i);0>=o.X(t)&&(s=s.add(n),r=o),i=Us(i,1),n=Us(n,1)}return e=Os(t,s.R(e)),new Ms(s,e)}for(s=Ns;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),i=48>=(i=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,i-48),o=(r=Ss(n)).R(e);As(o)||0<o.X(t);)o=(r=Ss(n-=i)).R(e);xs(r)&&(r=Ps),s=s.add(r),t=Os(t,o)}return new Ms(s,t)}function qs(t){for(var e=t.g.length+1,n=[],i=0;i<e;i++)n[i]=t.D(i)<<1|t.D(i-1)>>>31;return new Es(n,t.h)}function Us(t,e){var n=e>>5;e%=32;for(var i=t.g.length-n,s=[],r=0;r<i;r++)s[r]=0<e?t.D(r+n)>>>e|t.D(r+n+1)<<32-e:t.D(r+n);return new Es(s,t.h)}(At=Es.prototype).ea=function(){if(As(this))return-Ds(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var i=this.D(n);t+=(0<=i?i:ks+i)*e,e*=ks}return t},At.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(xs(this))return"0";if(As(this))return"-"+Ds(this).toString(t);for(var e=Ss(Math.pow(t,6)),n=this,i="";;){var s=Fs(n,e).g,r=((0<(n=Os(n,s.R(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(xs(n=s))return r+i;for(;6>r.length;)r="0"+r;i=r+i}},At.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},At.X=function(t){return As(t=Os(this,t))?-1:xs(t)?0:1},At.abs=function(){return As(this)?Ds(this):this},At.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0,s=0;s<=e;s++){var r=i+(65535&this.D(s))+(65535&t.D(s)),o=(r>>>16)+(this.D(s)>>>16)+(t.D(s)>>>16);i=o>>>16,r&=65535,o&=65535,n[s]=o<<16|r}return new Es(n,-2147483648&n[n.length-1]?-1:0)},At.R=function(t){if(xs(this)||xs(t))return Ns;if(As(this))return As(t)?Ds(this).R(Ds(t)):Ds(Ds(this).R(t));if(As(t))return Ds(this.R(Ds(t)));if(0>this.X(Rs)&&0>t.X(Rs))return Ss(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],i=0;i<2*e;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var s=0;s<t.g.length;s++){var r=this.D(i)>>>16,o=65535&this.D(i),a=t.D(s)>>>16,h=65535&t.D(s);n[2*i+2*s]+=o*h,Ls(n,2*i+2*s),n[2*i+2*s+1]+=r*h,Ls(n,2*i+2*s+1),n[2*i+2*s+1]+=o*a,Ls(n,2*i+2*s+1),n[2*i+2*s+2]+=r*a,Ls(n,2*i+2*s+2)}for(i=0;i<e;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=e;i<2*e;i++)n[i]=0;return new Es(n,0)},At.gb=function(t){return Fs(this,t).h},At.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.D(i)&t.D(i);return new Es(n,this.h&t.h)},At.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.D(i)|t.D(i);return new Es(n,this.h|t.h)},At.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.D(i)^t.D(i);return new Es(n,this.h^t.h)},_s.prototype.createWebChannel=_s.prototype.g,ms.prototype.send=ms.prototype.u,ms.prototype.open=ms.prototype.m,ms.prototype.close=ms.prototype.close,bn.NO_ERROR=0,bn.TIMEOUT=8,bn.HTTP_ERROR=6,En.COMPLETE="complete",Sn.EventType=Nn,Nn.OPEN="a",Nn.CLOSE="b",Nn.ERROR="c",Nn.MESSAGE="d",Be.prototype.listen=Be.prototype.O,Mi.prototype.listenOnce=Mi.prototype.P,Mi.prototype.getLastError=Mi.prototype.Sa,Mi.prototype.getLastErrorCode=Mi.prototype.Ia,Mi.prototype.getStatus=Mi.prototype.da,Mi.prototype.getResponseJson=Mi.prototype.Wa,Mi.prototype.getResponseText=Mi.prototype.ja,Mi.prototype.send=Mi.prototype.ha,Mi.prototype.setWithCredentials=Mi.prototype.Oa,Cs.prototype.digest=Cs.prototype.l,Cs.prototype.reset=Cs.prototype.reset,Cs.prototype.update=Cs.prototype.j,Es.prototype.add=Es.prototype.add,Es.prototype.multiply=Es.prototype.R,Es.prototype.modulo=Es.prototype.gb,Es.prototype.compare=Es.prototype.X,Es.prototype.toNumber=Es.prototype.ea,Es.prototype.toString=Es.prototype.toString,Es.prototype.getBits=Es.prototype.D,Es.fromNumber=Ss,Es.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return Ds(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var i=Ss(Math.pow(n,8)),s=Ns,r=0;r<e.length;r+=8){var o=Math.min(8,e.length-r),a=parseInt(e.substring(r,r+o),n);8>o?(o=Ss(Math.pow(n,o)),s=s.R(o).add(Ss(a))):s=(s=s.R(i)).add(Ss(a))}return s},Ot.createWebChannelTransport=function(){return new _s},Ot.getStatEventTarget=function(){return gn()},Ot.ErrorCode=bn,Ot.EventType=En,Ot.Event=pn,Ot.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Ot.FetchXmlHttpFactory=Pi,Ot.WebChannel=Sn,Ot.XhrIo=Mi,Ot.Md5=Cs;var js=Ot.Integer=Es;const Bs="@firebase/firestore";class Hs{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Hs.UNAUTHENTICATED=new Hs(null),Hs.GOOGLE_CREDENTIALS=new Hs("google-credentials-uid"),Hs.FIRST_PARTY=new Hs("first-party-uid"),Hs.MOCK_USER=new Hs("mock-user");let zs="10.2.0";const Ws=new H("@firebase/firestore");function Vs(t,...e){if(Ws.logLevel<=M.DEBUG){const n=e.map(Ys);Ws.debug(`Firestore (${zs}): ${t}`,...n)}}function $s(t,...e){if(Ws.logLevel<=M.ERROR){const n=e.map(Ys);Ws.error(`Firestore (${zs}): ${t}`,...n)}}function Ys(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function Ks(t="Unexpected state"){const e=`FIRESTORE (${zs}) INTERNAL ASSERTION FAILED: `+t;throw $s(e),new Error(e)}function Gs(t,e){t||Ks()}const Xs="cancelled",Qs="invalid-argument",Js="failed-precondition",Zs="unavailable";class tr extends g{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class er{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class nr{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class ir{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Hs.UNAUTHENTICATED)))}shutdown(){}}class sr{constructor(t){this.t=t,this.currentUser=Hs.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const i=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let s=new er;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new er,t.enqueueRetryable((()=>i(this.currentUser)))};const r=()=>{const e=s;t.enqueueRetryable((async()=>{await e.promise,await i(this.currentUser)}))},o=t=>{Vs("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),r()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(Vs("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new er)}}),0),r()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(Vs("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Gs("string"==typeof e.accessToken),new nr(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return Gs(null===t||"string"==typeof t),new Hs(t)}}class rr{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=Hs.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class or{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new rr(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable((()=>e(Hs.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class ar{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class hr{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){const n=t=>{null!=t.error&&Vs("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.R;return this.R=t.token,Vs("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const i=t=>{Vs("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.A.onInit((t=>i(t))),setTimeout((()=>{if(!this.appCheck){const t=this.A.getImmediate({optional:!0});t?i(t):Vs("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(Gs("string"==typeof t.token),this.R=t.token,new ar(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function lr(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class cr{static V(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=lr(40);for(let i=0;i<n.length;++i)e.length<20&&n[i]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[i]%62))}return e}}function ur(t,e){return t<e?-1:t>e?1:0}class dr{constructor(t,e,n){void 0===e?e=0:e>t.length&&Ks(),void 0===n?n=t.length-e:n>t.length-e&&Ks(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===dr.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof dr?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let i=0;i<n;i++){const n=t.get(i),s=e.get(i);if(n<s)return-1;if(n>s)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class pr extends dr{construct(t,e,n){return new pr(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new tr(Qs,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new pr(e)}static emptyPath(){return new pr([])}}class fr{constructor(t){this.path=t}static fromPath(t){return new fr(pr.fromString(t))}static fromName(t){return new fr(pr.fromString(t).popFirst(5))}static empty(){return new fr(pr.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===pr.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return pr.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new fr(new pr(t.slice()))}}function gr(t){return"IndexedDbTransactionError"===t.name}class _r{constructor(t,e){this.comparator=t,this.root=e||yr.EMPTY}insert(t,e){return new _r(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,yr.BLACK,null,null))}remove(t){return new _r(this.comparator,this.root.remove(t,this.comparator).copy(null,null,yr.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(t,n.key);if(0===i)return e+n.left.size;i<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new mr(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new mr(this.root,t,this.comparator,!1)}getReverseIterator(){return new mr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new mr(this.root,t,this.comparator,!0)}}class mr{constructor(t,e,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class yr{constructor(t,e,n,i,s){this.key=t,this.value=e,this.color=null!=n?n:yr.RED,this.left=null!=i?i:yr.EMPTY,this.right=null!=s?s:yr.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,i,s){return new yr(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this;const s=n(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===s?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return yr.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===e(t,i.key)){if(i.right.isEmpty())return yr.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,yr.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,yr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ks();if(this.right.isRed())throw Ks();const t=this.left.check();if(t!==this.right.check())throw Ks();return t+(this.isRed()?0:1)}}yr.EMPTY=null,yr.RED=!0,yr.BLACK=!1,yr.EMPTY=new class{constructor(){this.size=0}get key(){throw Ks()}get value(){throw Ks()}get color(){throw Ks()}get left(){throw Ks()}get right(){throw Ks()}copy(t,e,n,i,s){return this}insert(t,e,n){return new yr(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class vr{constructor(t){this.comparator=t,this.data=new _r(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new wr(this.data.getIterator())}getIteratorFrom(t){return new wr(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof vr))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(t,i))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new vr(this.comparator);return e.data=t,e}}class wr{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Cr extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class br{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new Cr("Invalid base64 string: "+t):t}}(t);return new br(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new br(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return ur(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}function Er(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}br.EMPTY_BYTE_STRING=new br("");class Tr{constructor(t,e,n,i,s,r,o,a,h){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=r,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=h}}class Ir{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new Ir("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof Ir&&t.projectId===this.projectId&&t.database===this.database}}var Sr,kr;new _r(fr.comparator),new _r(fr.comparator),new _r(fr.comparator),new vr(fr.comparator),new vr(ur),(kr=Sr||(Sr={}))[kr.OK=0]="OK",kr[kr.CANCELLED=1]="CANCELLED",kr[kr.UNKNOWN=2]="UNKNOWN",kr[kr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",kr[kr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",kr[kr.NOT_FOUND=5]="NOT_FOUND",kr[kr.ALREADY_EXISTS=6]="ALREADY_EXISTS",kr[kr.PERMISSION_DENIED=7]="PERMISSION_DENIED",kr[kr.UNAUTHENTICATED=16]="UNAUTHENTICATED",kr[kr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",kr[kr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",kr[kr.ABORTED=10]="ABORTED",kr[kr.OUT_OF_RANGE=11]="OUT_OF_RANGE",kr[kr.UNIMPLEMENTED=12]="UNIMPLEMENTED",kr[kr.INTERNAL=13]="INTERNAL",kr[kr.UNAVAILABLE=14]="UNAVAILABLE",kr[kr.DATA_LOSS=15]="DATA_LOSS",new js([4294967295,4294967295],0);class Nr{constructor(){}It(t,e){this.Tt(t,e),e.Et()}Tt(t,e){if("nullValue"in t)this.dt(e,5);else if("booleanValue"in t)this.dt(e,10),e.At(t.booleanValue?1:0);else if("integerValue"in t)this.dt(e,15),e.At(Er(t.integerValue));else if("doubleValue"in t){const n=Er(t.doubleValue);isNaN(n)?this.dt(e,13):(this.dt(e,15),function(t){return 0===t&&1/t==-1/0}(n)?e.At(0):e.At(n))}else if("timestampValue"in t){const n=t.timestampValue;this.dt(e,20),"string"==typeof n?e.Rt(n):(e.Rt(`${n.seconds||""}`),e.At(n.nanos||0))}else if("stringValue"in t)this.Vt(t.stringValue,e),this.ft(e);else if("bytesValue"in t)this.dt(e,30),e.gt(function(t){return"string"==typeof t?br.fromBase64String(t):br.fromUint8Array(t)}(t.bytesValue)),this.ft(e);else if("referenceValue"in t)this.yt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.dt(e,45),e.At(n.latitude||0),e.At(n.longitude||0)}else"mapValue"in t?function(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}(t)?this.dt(e,Number.MAX_SAFE_INTEGER):(this.wt(t.mapValue,e),this.ft(e)):"arrayValue"in t?(this.St(t.arrayValue,e),this.ft(e)):Ks()}Vt(t,e){this.dt(e,25),this.bt(t,e)}bt(t,e){e.Rt(t)}wt(t,e){const n=t.fields||{};this.dt(e,55);for(const t of Object.keys(n))this.Vt(t,e),this.Tt(n[t],e)}St(t,e){const n=t.values||[];this.dt(e,50);for(const t of n)this.Tt(t,e)}yt(t,e){this.dt(e,37),fr.fromName(t).path.forEach((t=>{this.dt(e,60),this.bt(t,e)}))}dt(t,e){t.At(e)}ft(t){t.At(2)}}Nr.Dt=new Nr,new Uint8Array(0);class Pr{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new Pr(t,Pr.DEFAULT_COLLECTION_PERCENTILE,Pr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Rr(){return"undefined"!=typeof document?document:null}Pr.DEFAULT_COLLECTION_PERCENTILE=10,Pr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Pr.DEFAULT=new Pr(41943040,Pr.DEFAULT_COLLECTION_PERCENTILE,Pr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Pr.DISABLED=new Pr(-1,0,0);class xr{constructor(t,e,n=1e3,i=1.5,s=6e4){this.si=t,this.timerId=e,this.bo=n,this.Do=i,this.vo=s,this.Co=0,this.Fo=null,this.Mo=Date.now(),this.reset()}reset(){this.Co=0}xo(){this.Co=this.vo}Oo(t){this.cancel();const e=Math.floor(this.Co+this.No()),n=Math.max(0,Date.now()-this.Mo),i=Math.max(0,e-n);i>0&&Vs("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Co} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Fo=this.si.enqueueAfterDelay(this.timerId,i,(()=>(this.Mo=Date.now(),t()))),this.Co*=this.Do,this.Co<this.bo&&(this.Co=this.bo),this.Co>this.vo&&(this.Co=this.vo)}Bo(){null!==this.Fo&&(this.Fo.skipDelay(),this.Fo=null)}cancel(){null!==this.Fo&&(this.Fo.cancel(),this.Fo=null)}No(){return(Math.random()-.5)*this.Co}}class Ar{constructor(t,e,n,i,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new er,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,i,s){const r=Date.now()+n,o=new Ar(t,e,r,i,s);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new tr(Xs,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}class Dr{constructor(t,e,n,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=i,this.user=Hs.UNAUTHENTICATED,this.clientId=cr.V(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{Vs("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(Vs("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new tr(Js,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new er;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=function(t,e){if($s("AsyncQueue",`${e}: ${t}`),gr(t))return new tr(Zs,`${e}: ${t}`);throw t}(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}function Or(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const Lr=new Map;class Mr{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new tr(Qs,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new tr(Qs,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,i){if(!0===e&&!0===i)throw new tr(Qs,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Or(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new tr(Qs,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new tr(Qs,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new tr(Qs,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Fr{constructor(t,e,n,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Mr({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new tr(Js,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new tr(Js,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Mr(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new ir;switch(t.type){case"firstParty":return new or(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new tr(Qs,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=Lr.get(t);e&&(Vs("ComponentProvider","Removing Datastore"),Lr.delete(t),e.terminate())}(this),Promise.resolve()}}class qr{constructor(){this.Ga=Promise.resolve(),this.za=[],this.ja=!1,this.Ha=[],this.Ja=null,this.Ya=!1,this.Za=!1,this.Xa=[],this.$o=new xr(this,"async_queue_retry"),this.eu=()=>{const t=Rr();t&&Vs("AsyncQueue","Visibility state changed to "+t.visibilityState),this.$o.Bo()};const t=Rr();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.eu)}get isShuttingDown(){return this.ja}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.tu(),this.nu(t)}enterRestrictedMode(t){if(!this.ja){this.ja=!0,this.Za=t||!1;const e=Rr();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.eu)}}enqueue(t){if(this.tu(),this.ja)return new Promise((()=>{}));const e=new er;return this.nu((()=>this.ja&&this.Za?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.za.push(t),this.ru())))}async ru(){if(0!==this.za.length){try{await this.za[0](),this.za.shift(),this.$o.reset()}catch(t){if(!gr(t))throw t;Vs("AsyncQueue","Operation failed with retryable error: "+t)}this.za.length>0&&this.$o.Oo((()=>this.ru()))}}nu(t){const e=this.Ga.then((()=>(this.Ya=!0,t().catch((t=>{this.Ja=t,this.Ya=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw $s("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.Ya=!1,t))))));return this.Ga=e,e}enqueueAfterDelay(t,e,n){this.tu(),this.Xa.indexOf(t)>-1&&(e=0);const i=Ar.createAndSchedule(this,t,e,n,(t=>this.iu(t)));return this.Ha.push(i),i}tu(){this.Ja&&Ks()}verifyOperationInProgress(){}async su(){let t;do{t=this.Ga,await t}while(t!==this.Ga)}ou(t){for(const e of this.Ha)if(e.timerId===t)return!0;return!1}_u(t){return this.su().then((()=>{this.Ha.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.Ha)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.su()}))}au(t){this.Xa.push(t)}iu(t){const e=this.Ha.indexOf(t);this.Ha.splice(e,1)}}class Ur extends Fr{constructor(t,e,n,i){super(t,e,n,i),this.type="firestore",this._queue=new qr,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||function(t){var e,n,i;const s=t._freezeSettings(),r=function(t,e,n,i){return new Tr(t,e,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,Or(i.experimentalLongPollingOptions),i.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,s);t._firestoreClient=new Dr(t._authCredentials,t._appCheckCredentials,t._queue,r),(null===(n=s.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(i=s.localCache)||void 0===i?void 0:i._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.localCache.kind,_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider})}(this),this._firestoreClient.terminate()}}!function(t,e=!0){!function(t){zs=t}(yt),gt(new x("firestore",((t,{instanceIdentifier:n,options:i})=>{const s=t.getProvider("app").getImmediate(),r=new Ur(new sr(t.getProvider("auth-internal")),new hr(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new tr(Qs,'"projectId" not provided in firebase.initializeApp.');return new Ir(t.options.projectId,e)}(s,n),s);return i=Object.assign({useFetchStreams:e},i),r._setSettings(i),r}),"PUBLIC").setMultipleInstances(!0)),wt(Bs,"4.1.1",t),wt(Bs,"4.1.1","esm2017")}();const jr="@firebase/database",Br="1.0.1";let Hr="";class zr{constructor(t){this.domStorage_=t,this.prefix_="firebase:"}set(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),v(e))}get(t){const e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:y(e)}remove(t){this.domStorage_.removeItem(this.prefixedName_(t))}prefixedName_(t){return this.prefix_+t}toString(){return this.domStorage_.toString()}}class Wr{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e}get(t){return C(this.cache_,t)?this.cache_[t]:null}remove(t){delete this.cache_[t]}}const Vr=function(t){try{if("undefined"!=typeof window&&void 0!==window[t]){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new zr(e)}}catch(t){}return new Wr},$r=Vr("localStorage"),Yr=Vr("sessionStorage"),Kr=new H("@firebase/database"),Gr=function(){let t=1;return function(){return t++}}(),Xr=function(t){const n=function(t){const n=[];let i=0;for(let s=0;s<t.length;s++){let r=t.charCodeAt(s);if(r>=55296&&r<=56319){const n=r-55296;s++,e(s<t.length,"Surrogate pair missing trail surrogate."),r=65536+(n<<10)+(t.charCodeAt(s)-56320)}r<128?n[i++]=r:r<2048?(n[i++]=r>>6|192,n[i++]=63&r|128):r<65536?(n[i++]=r>>12|224,n[i++]=r>>6&63|128,n[i++]=63&r|128):(n[i++]=r>>18|240,n[i++]=r>>12&63|128,n[i++]=r>>6&63|128,n[i++]=63&r|128)}return n}(t),i=new k;i.update(n);const r=i.digest();return s.encodeByteArray(r)},Qr=function(...t){let e="";for(let n=0;n<t.length;n++){const i=t[n];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?e+=Qr.apply(null,i):e+="object"==typeof i?v(i):i,e+=" "}return e};let Jr=null,Zr=!0;const to=function(...t){if(!0===Zr&&(Zr=!1,null===Jr&&!0===Yr.get("logging_enabled")&&(n=!0,e(!i||!0===n||!1===n,"Can't turn on custom loggers persistently."),!0===n?(Kr.logLevel=M.VERBOSE,Jr=Kr.log.bind(Kr),i&&Yr.set("logging_enabled",!0)):"function"==typeof n?Jr=n:(Jr=null,Yr.remove("logging_enabled")))),Jr){const e=Qr.apply(null,t);Jr(e)}var n,i},eo=function(t){return function(...e){to(t,...e)}},no=function(...t){const e="FIREBASE INTERNAL ERROR: "+Qr(...t);Kr.error(e)},io=function(...t){const e=`FIREBASE FATAL ERROR: ${Qr(...t)}`;throw Kr.error(e),new Error(e)},so=function(...t){const e="FIREBASE WARNING: "+Qr(...t);Kr.warn(e)},ro=function(t){return"number"==typeof t&&(t!=t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},oo="[MIN_NAME]",ao="[MAX_NAME]",ho=function(t,e){if(t===e)return 0;if(t===oo||e===ao)return-1;if(e===oo||t===ao)return 1;{const n=mo(t),i=mo(e);return null!==n?null!==i?n-i==0?t.length-e.length:n-i:-1:null!==i?1:t<e?-1:1}},lo=function(t,e){return t===e?0:t<e?-1:1},co=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+v(e))},uo=function(t){if("object"!=typeof t||null===t)return v(t);const e=[];for(const n in t)e.push(n);e.sort();let n="{";for(let i=0;i<e.length;i++)0!==i&&(n+=","),n+=v(e[i]),n+=":",n+=uo(t[e[i]]);return n+="}",n},po=function(t,e){const n=t.length;if(n<=e)return[t];const i=[];for(let s=0;s<n;s+=e)s+e>n?i.push(t.substring(s,n)):i.push(t.substring(s,s+e));return i};function fo(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const go=function(t){e(!ro(t),"Invalid JSON number");let n,i,s,r,o;0===t?(i=0,s=0,n=1/t==-1/0?1:0):(n=t<0,(t=Math.abs(t))>=Math.pow(2,-1022)?(r=Math.min(Math.floor(Math.log(t)/Math.LN2),1023),i=r+1023,s=Math.round(t*Math.pow(2,52-r)-Math.pow(2,52))):(i=0,s=Math.round(t/Math.pow(2,-1074))));const a=[];for(o=52;o;o-=1)a.push(s%2?1:0),s=Math.floor(s/2);for(o=11;o;o-=1)a.push(i%2?1:0),i=Math.floor(i/2);a.push(n?1:0),a.reverse();const h=a.join("");let l="";for(o=0;o<64;o+=8){let t=parseInt(h.substr(o,8),2).toString(16);1===t.length&&(t="0"+t),l+=t}return l.toLowerCase()},_o=new RegExp("^-?(0*)\\d{1,10}$"),mo=function(t){if(_o.test(t)){const e=Number(t);if(e>=-2147483648&&e<=2147483647)return e}return null},yo=function(t){try{t()}catch(t){setTimeout((()=>{const e=t.stack||"";throw so("Exception was thrown by user callback.",e),t}),Math.floor(0))}},vo=function(t,e){const n=setTimeout(t,e);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class wo{constructor(t,e){this.appName_=t,this.appCheckProvider=e,this.appCheck=null==e?void 0:e.getImmediate({optional:!0}),this.appCheck||null==e||e.get().then((t=>this.appCheck=t))}getToken(t){return this.appCheck?this.appCheck.getToken(t):new Promise(((e,n)=>{setTimeout((()=>{this.appCheck?this.getToken(t).then(e,n):e(null)}),0)}))}addTokenChangeListener(t){var e;null===(e=this.appCheckProvider)||void 0===e||e.get().then((e=>e.addTokenListener(t)))}notifyForInvalidToken(){so(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class Co{constructor(t,e,n){this.appName_=t,this.firebaseOptions_=e,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((t=>this.auth_=t))}getToken(t){return this.auth_?this.auth_.getToken(t).catch((t=>t&&"auth/token-not-initialized"===t.code?(to("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t))):new Promise(((e,n)=>{setTimeout((()=>{this.auth_?this.getToken(t).then(e,n):e(null)}),0)}))}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then((e=>e.addAuthTokenListener(t)))}removeTokenChangeListener(t){this.authProvider_.get().then((e=>e.removeAuthTokenListener(t)))}notifyForInvalidToken(){let t='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',so(t)}}class bo{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}bo.OWNER="owner";const Eo="5",To=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Io="ac",So="websocket",ko="long_polling";class No{constructor(t,e,n,i,s=!1,r="",o=!1,a=!1){this.secure=e,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=r,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=$r.get("host:"+t)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&$r.set("host:"+this._host,this.internalHost))}toString(){let t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t}toURLString(){const t=this.secure?"https://":"http://",e=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${t}${this.host}/${e}`}}function Po(t,n,i){let s;if(e("string"==typeof n,"typeof type must == string"),e("object"==typeof i,"typeof params must == object"),n===So)s=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else{if(n!==ko)throw new Error("Unknown connection type: "+n);s=(t.secure?"https://":"http://")+t.internalHost+"/.lp?"}(function(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams})(t)&&(i.ns=t.namespace);const r=[];return fo(i,((t,e)=>{r.push(t+"="+e)})),s+r.join("&")}class Ro{constructor(){this.counters_={}}incrementCounter(t,e=1){C(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e}get(){return l(this.counters_)}}const xo={},Ao={};function Do(t){const e=t.toString();return xo[e]||(xo[e]=new Ro),xo[e]}class Oo{constructor(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(t,e){for(this.pendingResponses[t]=e;this.pendingResponses[this.currentResponseNum];){const t=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let e=0;e<t.length;++e)t[e]&&yo((()=>{this.onMessage_(t[e])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const Lo="start";class Mo{constructor(t,e,n,i,s,r,o){this.connId=t,this.repoInfo=e,this.applicationId=n,this.appCheckToken=i,this.authToken=s,this.transportSessionId=r,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=eo(t),this.stats_=Do(e),this.urlFn=t=>(this.appCheckToken&&(t[Io]=this.appCheckToken),Po(e,ko,t))}open(t,e){this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new Oo(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{let e=!1;const n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new Fo(((...t)=>{const[e,n,i,s,r]=t;if(this.incrementIncomingBytes_(t),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,e===Lo)this.id=n,this.password=i;else{if("close"!==e)throw new Error("Unrecognized command received: "+e);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...t)=>{const[e,n]=t;this.incrementIncomingBytes_(t),this.myPacketOrderer.handleResponse(e,n)}),(()=>{this.onClosed_()}),this.urlFn);const t={};t[Lo]="t",t.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=this.scriptTagHolder.uniqueCallbackIdentifier),t.v=Eo,this.transportSessionId&&(t.s=this.transportSessionId),this.lastSessionId&&(t.ls=this.lastSessionId),this.applicationId&&(t.p=this.applicationId),this.appCheckToken&&(t[Io]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&To.test(location.hostname)&&(t.r="f");const e=this.urlFn(t);this.log_("Connecting via long-poll to "+e),this.scriptTagHolder.addTag(e,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Mo.forceAllow_=!0}static forceDisallow(){Mo.forceDisallow_=!0}static isAvailable(){return!(!Mo.forceAllow_&&(Mo.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(t){const e=v(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const n=o(e),i=po(n,1840);for(let t=0;t<i.length;t++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[t]),this.curSegmentNum++}addDisconnectPingFrame(t,e){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(t){const e=v(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)}}class Fo{constructor(t,e,n,i){this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Gr(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=e,this.myIFrame=Fo.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";<\/script>');const i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(t){to("frame writing exception"),t.stack&&to(t.stack),to(t)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||to("No IE domain setting required")}catch(e){const n=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const t=this.onDisconnect;t&&(this.onDisconnect=null,t())}startLongPoll(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;let e=this.urlFn(t),n="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+n.length<=1870;){const t=this.pendingSegs.shift();n=n+"&seg"+i+"="+t.seg+"&ts"+i+"="+t.ts+"&d"+i+"="+t.d,i++}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1}enqueueSegment(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(t,e){this.outstandingRequests.add(e);const n=()=>{this.outstandingRequests.delete(e),this.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(t,(()=>{clearTimeout(i),n()}))}addTag(t,e){setTimeout((()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=t,n.onload=n.onreadystatechange=function(){const t=n.readyState;t&&"loaded"!==t&&"complete"!==t||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),e())},n.onerror=()=>{to("Long-poll script failed to load: "+t),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(t){}}),Math.floor(1))}}let qo=null;"undefined"!=typeof MozWebSocket?qo=MozWebSocket:"undefined"!=typeof WebSocket&&(qo=WebSocket);class Uo{constructor(t,e,n,i,s,r,o){this.connId=t,this.applicationId=n,this.appCheckToken=i,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=eo(this.connId),this.stats_=Do(e),this.connURL=Uo.connectionURL_(e,r,o,i,n),this.nodeAdmin=e.nodeAdmin}static connectionURL_(t,e,n,i,s){const r={};return r.v=Eo,"undefined"!=typeof location&&location.hostname&&To.test(location.hostname)&&(r.r="f"),e&&(r.s=e),n&&(r.ls=n),i&&(r[Io]=i),s&&(r.p=s),Po(t,So,r)}open(t,e){this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,$r.set("previous_websocket_failure",!0);try{let t;0,this.mySock=new qo(this.connURL,[],t)}catch(t){this.log_("Error instantiating WebSocket.");const e=t.message||t.data;return e&&this.log_(e),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=t=>{this.handleIncomingFrame(t)},this.mySock.onerror=t=>{this.log_("WebSocket error.  Closing connection.");const e=t.message||t.data;e&&this.log_(e),this.onClosed_()}}start(){}static forceDisallow(){Uo.forceDisallow_=!0}static isAvailable(){let t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const e=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(e);n&&n.length>1&&parseFloat(n[1])<4.4&&(t=!0)}return!t&&null!==qo&&!Uo.forceDisallow_}static previouslyFailed(){return $r.isInMemoryStorage||!0===$r.get("previous_websocket_failure")}markConnectionHealthy(){$r.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const e=y(t);this.onMessage(e)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(e(null===this.frames,"We already have a frame buffer"),t.length<=6){const e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(null===this.mySock)return;const e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{const t=this.extractFrameCount_(e);null!==t&&this.appendFrame_(t)}}send(t){this.resetKeepAlive();const e=v(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const n=po(e,16384);n.length>1&&this.sendString_(String(n.length));for(let t=0;t<n.length;t++)this.sendString_(n[t])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Uo.responsesRequiredToBeHealthy=2,Uo.healthyTimeout=3e4;class jo{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[Mo,Uo]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){const e=Uo&&Uo.isAvailable();let n=e&&!Uo.previouslyFailed();if(t.webSocketOnly&&(e||so("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Uo];else{const t=this.transports_=[];for(const e of jo.ALL_TRANSPORTS)e&&e.isAvailable()&&t.push(e);jo.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}jo.globalTransportInitialized_=!1;class Bo{constructor(t,e,n,i,s,r,o,a,h,l){this.id=t,this.repoInfo_=e,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=r,this.onReady_=o,this.onDisconnect_=a,this.onKill_=h,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=eo("c:"+this.id+":"),this.transportManager_=new jo(e),this.log_("Connection created"),this.start_()}start_(){const t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const e=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(e,n)}),Math.floor(0));const i=t.healthyTimeout||0;i>0&&(this.healthyTimeout_=vo((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(t){const e={t:"d",d:t};this.sendData_(e)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(t){if("t"in t){const e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(t){const e=co("t",t),n=co("d",t);if("c"===e)this.onSecondaryControl_(n);else{if("d"!==e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(t){const e=co("t",t),n=co("d",t);"c"===e?this.onControl_(n):"d"===e&&this.onDataMessage_(n)}onDataMessage_(t){this.onPrimaryResponse_(),this.onMessage_(t)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(t){const e=co("t",t);if("d"in t){const n=t.d;if("h"===e){const t=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(t.h=this.repoInfo_.host),this.onHandshake_(t)}else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let t=0;t<this.pendingDataMessages.length;++t)this.onDataMessage_(this.pendingDataMessages[t]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?no("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):no("Unknown control packet command: "+e)}}onHandshake_(t){const e=t.ts,n=t.v,i=t.h;this.sessionId=t.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),Eo!==n&&so("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)}startUpgrade_(t){this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const e=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(e,n),vo((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.host=t,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(t,e){this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):vo((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()}onConnectionLost_(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&($r.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Ho{put(t,e,n,i){}merge(t,e,n,i){}refreshAuthToken(t){}refreshAppCheckToken(t){}onDisconnectPut(t,e,n){}onDisconnectMerge(t,e,n){}onDisconnectCancel(t,e){}reportStats(t){}}class zo{constructor(t){this.allowedEvents_=t,this.listeners_={},e(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}trigger(t,...e){if(Array.isArray(this.listeners_[t])){const n=[...this.listeners_[t]];for(let t=0;t<n.length;t++)n[t].callback.apply(n[t].context,e)}}on(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});const i=this.getInitialEvent(t);i&&e.apply(n,i)}off(t,e,n){this.validateEventType_(t);const i=this.listeners_[t]||[];for(let t=0;t<i.length;t++)if(i[t].callback===e&&(!n||n===i[t].context))return void i.splice(t,1)}validateEventType_(t){e(this.allowedEvents_.find((e=>e===t)),"Unknown event: "+t)}}class Wo extends zo{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||f()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}static getInstance(){return new Wo}getInitialEvent(t){return e("online"===t,"Unknown event type: "+t),[this.online_]}currentlyOnline(){return this.online_}}class Vo{constructor(t,e){if(void 0===e){this.pieces_=t.split("/");let e=0;for(let t=0;t<this.pieces_.length;t++)this.pieces_[t].length>0&&(this.pieces_[e]=this.pieces_[t],e++);this.pieces_.length=e,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}toString(){let t="";for(let e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"}}function $o(){return new Vo("")}function Yo(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function Ko(t){return t.pieces_.length-t.pieceNum_}function Go(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new Vo(t.pieces_,e)}function Xo(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function Qo(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function Jo(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new Vo(e,0)}function Zo(t,e){const n=[];for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);if(e instanceof Vo)for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);else{const t=e.split("/");for(let e=0;e<t.length;e++)t[e].length>0&&n.push(t[e])}return new Vo(n,0)}function ta(t){return t.pieceNum_>=t.pieces_.length}function ea(t,e){const n=Yo(t),i=Yo(e);if(null===n)return e;if(n===i)return ea(Go(t),Go(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function na(t,e){if(Ko(t)!==Ko(e))return!1;for(let n=t.pieceNum_,i=e.pieceNum_;n<=t.pieces_.length;n++,i++)if(t.pieces_[n]!==e.pieces_[i])return!1;return!0}function ia(t,e){let n=t.pieceNum_,i=e.pieceNum_;if(Ko(t)>Ko(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[i])return!1;++n,++i}return!0}class sa{constructor(t,e){this.errorPrefix_=e,this.parts_=Qo(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(let t=0;t<this.parts_.length;t++)this.byteLength_+=P(this.parts_[t]);ra(this)}}function ra(t){if(t.byteLength_>768)throw new Error(t.errorPrefix_+"has a key path longer than 768 bytes ("+t.byteLength_+").");if(t.parts_.length>32)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+oa(t))}function oa(t){return 0===t.parts_.length?"":"in property '"+t.parts_.join(".")+"'"}class aa extends zo{constructor(){let t,e;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(e="visibilitychange",t="hidden"):void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(e="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,(()=>{const e=!document[t];e!==this.visible_&&(this.visible_=e,this.trigger("visible",e))}),!1)}static getInstance(){return new aa}getInitialEvent(t){return e("visible"===t,"Unknown event type: "+t),[this.visible_]}}const ha=1e3;class la extends Ho{constructor(t,e,n,i,s,r,o,a){if(super(),this.repoInfo_=t,this.applicationId_=e,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=s,this.authTokenProvider_=r,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=la.nextPersistentConnectionId_++,this.log_=eo("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=ha,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");aa.getInstance().on("visible",this.onVisible_,this),-1===t.host.indexOf("fblocal")&&Wo.getInstance().on("online",this.onOnline_,this)}sendRequest(t,n,i){const s=++this.requestNumber_,r={r:s,a:t,b:n};this.log_(v(r)),e(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),i&&(this.requestCBHash_[s]=i)}get(t){this.initConnection_();const e=new p,n={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:t=>{const n=t.d;"ok"===t.s?e.resolve(n):e.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),e.promise}listen(t,n,i,s){this.initConnection_();const r=t._queryIdentifier,o=t._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),e(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),e(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:n,query:t,tag:i};this.listens.get(o).set(r,a),this.connected_&&this.sendListen_(a)}sendGet_(t){const e=this.outstandingGets_[t];this.sendRequest("g",e.request,(n=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),e.onComplete&&e.onComplete(n)}))}sendListen_(t){const e=t.query,n=e._path.toString(),i=e._queryIdentifier;this.log_("Listen on "+n+" for "+i);const s={p:n};t.tag&&(s.q=e._queryObject,s.t=t.tag),s.h=t.hashFn(),this.sendRequest("q",s,(s=>{const r=s.d,o=s.s;la.warnOnListenWarnings_(r,e),(this.listens.get(n)&&this.listens.get(n).get(i))===t&&(this.log_("listen response",s),"ok"!==o&&this.removeListen_(n,i),t.onComplete&&t.onComplete(o,r))}))}static warnOnListenWarnings_(t,e){if(t&&"object"==typeof t&&C(t,"w")){const n=b(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const t='".indexOn": "'+e._queryParams.getIndex().toString()+'"',n=e._path.toString();so(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${t} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&40===t.length||function(t){const e=w(t).claims;return"object"==typeof e&&!0===e.admin}(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const t=this.authToken_,e=function(t){const e=w(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")}(t)?"auth":"gauth",n={cred:t};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(e,n,(e=>{const n=e.s,i=e.d||"error";this.authToken_===t&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(t=>{const e=t.s,n=t.d||"error";"ok"===e?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(e,n)}))}unlisten(t,n){const i=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),e(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,t._queryObject,n)}sendUnlisten_(t,e,n,i){this.log_("Unlisten on "+t+" for "+e);const s={p:t};i&&(s.q=n,s.t=i),this.sendRequest("n",s)}onDisconnectPut(t,e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})}onDisconnectMerge(t,e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})}onDisconnectCancel(t,e){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})}sendOnDisconnect_(t,e,n,i){const s={p:e,d:n};this.log_("onDisconnect "+t,s),this.sendRequest(t,s,(t=>{i&&setTimeout((()=>{i(t.s,t.d)}),Math.floor(0))}))}put(t,e,n,i){this.putInternal("p",t,e,n,i)}merge(t,e,n,i){this.putInternal("m",t,e,n,i)}putInternal(t,e,n,i,s){this.initConnection_();const r={p:e,d:n};void 0!==s&&(r.h=s),this.outstandingPuts_.push({action:t,request:r,onComplete:i}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+e)}sendPut_(t){const e=this.outstandingPuts_[t].action,n=this.outstandingPuts_[t].request,i=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(e,n,(n=>{this.log_(e+" response",n),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n.s,n.d)}))}reportStats(t){if(this.connected_){const e={c:t};this.log_("reportStats",e),this.sendRequest("s",e,(t=>{if("ok"!==t.s){const e=t.d;this.log_("reportStats","Error sending stats: "+e)}}))}}onDataMessage_(t){if("r"in t){this.log_("from server: "+v(t));const e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"apc"===t?this.onAppCheckRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):no("Unrecognized action received from server: "+v(t)+"\nAre you using the latest client?")}onReady_(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){e(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=ha,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=ha,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=ha),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const t=(new Date).getTime()-this.lastConnectionAttemptTime_;let e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const t=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+la.nextConnectionId_++,r=this.lastSessionId;let o=!1,a=null;const h=function(){a?a.close():(o=!0,i())},l=function(t){e(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(t)};this.realtime_={close:h,sendRequest:l};const c=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[e,h]=await Promise.all([this.authTokenProvider_.getToken(c),this.appCheckTokenProvider_.getToken(c)]);o?to("getToken() completed but was canceled"):(to("getToken() completed. Creating connection."),this.authToken_=e&&e.accessToken,this.appCheckToken_=h&&h.token,a=new Bo(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,n,i,(t=>{so(t+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),r))}catch(t){this.log_("Failed to get token: "+t),o||(this.repoInfo_.nodeAdmin&&so(t),h())}}}interrupt(t){to("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){to("Resuming connection for reason: "+t),delete this.interruptReasons_[t],E(this.interruptReasons_)&&(this.reconnectDelay_=ha,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){const e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){const e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(t,e){let n;n=e?e.map((t=>uo(t))).join("$"):"default";const i=this.removeListen_(t,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(t,e){const n=new Vo(t).toString();let i;if(this.listens.has(n)){const t=this.listens.get(n);i=t.get(e),t.delete(e),0===t.size&&this.listens.delete(n)}else i=void 0;return i}onAuthRevoked_(t,e){to("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,e){to("App check token revoked: "+t+"/"+e),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const e of t.values())this.sendListen_(e);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){const t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){const t={};let e="js";t["sdk."+e+"."+Hr.replace(/\./g,"-")]=1,f()?t["framework.cordova"]=1:"object"==typeof navigator&&"ReactNative"===navigator.product&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){const t=Wo.getInstance().currentlyOnline();return E(this.interruptReasons_)&&t}}la.nextPersistentConnectionId_=0,la.nextConnectionId_=0;class ca{constructor(t,e){this.name=t,this.node=e}static Wrap(t,e){return new ca(t,e)}}class ua{getCompare(){return this.compare.bind(this)}indexedValueChanged(t,e){const n=new ca(oo,t),i=new ca(oo,e);return 0!==this.compare(n,i)}minPost(){return ca.MIN}}let da;class pa extends ua{static get __EMPTY_NODE(){return da}static set __EMPTY_NODE(t){da=t}compare(t,e){return ho(t.name,e.name)}isDefinedOn(t){throw n("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(t,e){return!1}minPost(){return ca.MIN}maxPost(){return new ca(ao,da)}makePost(t,n){return e("string"==typeof t,"KeyIndex indexValue must always be a string."),new ca(t,da)}toString(){return".key"}}const fa=new pa;class ga{constructor(t,e,n,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let r=1;for(;!t.isEmpty();)if(r=e?n(t.key,e):1,i&&(r*=-1),r<0)t=this.isReverse_?t.left:t.right;else{if(0===r){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}getNext(){if(0===this.nodeStack_.length)return null;let t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}}}class _a{constructor(t,e,n,i,s){this.key=t,this.value=e,this.color=null!=n?n:_a.RED,this.left=null!=i?i:ma.EMPTY_NODE,this.right=null!=s?s:ma.EMPTY_NODE}copy(t,e,n,i,s){return new _a(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this;const s=n(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===s?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return ma.EMPTY_NODE;let t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,e){let n,i;if(n=this,e(t,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return ma.EMPTY_NODE;i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){const t=this.copy(null,null,_a.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,_a.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth_(){const t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}_a.RED=!0,_a.BLACK=!1;class ma{constructor(t,e=ma.EMPTY_NODE){this.comparator_=t,this.root_=e}insert(t,e){return new ma(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,_a.BLACK,null,null))}remove(t){return new ma(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,_a.BLACK,null,null))}get(t){let e,n=this.root_;for(;!n.isEmpty();){if(e=this.comparator_(t,n.key),0===e)return n.value;e<0?n=n.left:e>0&&(n=n.right)}return null}getPredecessorKey(t){let e,n=this.root_,i=null;for(;!n.isEmpty();){if(e=this.comparator_(t,n.key),0===e){if(n.left.isEmpty())return i?i.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:e>0&&(i=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(t){return this.root_.inorderTraversal(t)}reverseTraversal(t){return this.root_.reverseTraversal(t)}getIterator(t){return new ga(this.root_,null,this.comparator_,!1,t)}getIteratorFrom(t,e){return new ga(this.root_,t,this.comparator_,!1,e)}getReverseIteratorFrom(t,e){return new ga(this.root_,t,this.comparator_,!0,e)}getReverseIterator(t){return new ga(this.root_,null,this.comparator_,!0,t)}}function ya(t,e){return ho(t.name,e.name)}function va(t,e){return ho(t,e)}let wa;ma.EMPTY_NODE=new class{copy(t,e,n,i,s){return this}insert(t,e,n){return new _a(t,e,null)}remove(t,e){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const Ca=function(t){return"number"==typeof t?"number:"+go(t):"string:"+t},ba=function(t){if(t.isLeafNode()){const n=t.val();e("string"==typeof n||"number"==typeof n||"object"==typeof n&&C(n,".sv"),"Priority must be a string or number.")}else e(t===wa||t.isEmpty(),"priority of unexpected type.");e(t===wa||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Ea,Ta,Ia;class Sa{constructor(t,n=Sa.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=n,this.lazyHash_=null,e(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),ba(this.priorityNode_)}static set __childrenNodeConstructor(t){Ea=t}static get __childrenNodeConstructor(){return Ea}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new Sa(this.value_,t)}getImmediateChild(t){return".priority"===t?this.priorityNode_:Sa.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return ta(t)?this:".priority"===Yo(t)?this.priorityNode_:Sa.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,e){return null}updateImmediateChild(t,e){return".priority"===t?this.updatePriority(e):e.isEmpty()&&".priority"!==t?this:Sa.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)}updateChild(t,n){const i=Yo(t);return null===i?n:n.isEmpty()&&".priority"!==i?this:(e(".priority"!==i||1===Ko(t),".priority must be the last token in a path"),this.updateImmediateChild(i,Sa.__childrenNodeConstructor.EMPTY_NODE.updateChild(Go(t),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,e){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+Ca(this.priorityNode_.val())+":");const e=typeof this.value_;t+=e+":",t+="number"===e?go(this.value_):this.value_,this.lazyHash_=Xr(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===Sa.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof Sa.__childrenNodeConstructor?-1:(e(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const n=typeof t.value_,i=typeof this.value_,s=Sa.VALUE_TYPE_ORDER.indexOf(n),r=Sa.VALUE_TYPE_ORDER.indexOf(i);return e(s>=0,"Unknown leaf type: "+n),e(r>=0,"Unknown leaf type: "+i),s===r?"object"===i?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:r-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){const e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1}}Sa.VALUE_TYPE_ORDER=["object","boolean","number","string"];const ka=new class extends ua{compare(t,e){const n=t.node.getPriority(),i=e.node.getPriority(),s=n.compareTo(i);return 0===s?ho(t.name,e.name):s}isDefinedOn(t){return!t.getPriority().isEmpty()}indexedValueChanged(t,e){return!t.getPriority().equals(e.getPriority())}minPost(){return ca.MIN}maxPost(){return new ca(ao,new Sa("[PRIORITY-POST]",Ia))}makePost(t,e){const n=Ta(t);return new ca(e,new Sa("[PRIORITY-POST]",n))}toString(){return".priority"}},Na=Math.log(2);class Pa{constructor(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/Na,10)),this.current_=this.count-1;const n=(i=this.count,parseInt(Array(i+1).join("1"),2));var i;this.bits_=t+1&n}nextBitIsOne(){const t=!(this.bits_&1<<this.current_);return this.current_--,t}}const Ra=function(t,e,n,i){t.sort(e);const s=function(e,i){const r=i-e;let o,a;if(0===r)return null;if(1===r)return o=t[e],a=n?n(o):o,new _a(a,o.node,_a.BLACK,null,null);{const h=parseInt(r/2,10)+e,l=s(e,h),c=s(h+1,i);return o=t[h],a=n?n(o):o,new _a(a,o.node,_a.BLACK,l,c)}},r=function(e){let i=null,r=null,o=t.length;const a=function(e,i){const r=o-e,a=o;o-=e;const l=s(r+1,a),c=t[r],u=n?n(c):c;h(new _a(u,c.node,i,null,l))},h=function(t){i?(i.left=t,i=t):(r=t,i=t)};for(let t=0;t<e.count;++t){const n=e.nextBitIsOne(),i=Math.pow(2,e.count-(t+1));n?a(i,_a.BLACK):(a(i,_a.BLACK),a(i,_a.RED))}return r}(new Pa(t.length));return new ma(i||e,r)};let xa;const Aa={};class Da{constructor(t,e){this.indexes_=t,this.indexSet_=e}static get Default(){return e(Aa&&ka,"ChildrenNode.ts has not been loaded"),xa=xa||new Da({".priority":Aa},{".priority":ka}),xa}get(t){const e=b(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof ma?e:null}hasIndex(t){return C(this.indexSet_,t.toString())}addIndex(t,n){e(t!==fa,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let s=!1;const r=n.getIterator(ca.Wrap);let o,a=r.getNext();for(;a;)s=s||t.isDefinedOn(a.node),i.push(a),a=r.getNext();o=s?Ra(i,t.getCompare()):Aa;const h=t.toString(),l=Object.assign({},this.indexSet_);l[h]=t;const c=Object.assign({},this.indexes_);return c[h]=o,new Da(c,l)}addToIndexes(t,n){const i=T(this.indexes_,((i,s)=>{const r=b(this.indexSet_,s);if(e(r,"Missing index implementation for "+s),i===Aa){if(r.isDefinedOn(t.node)){const e=[],i=n.getIterator(ca.Wrap);let s=i.getNext();for(;s;)s.name!==t.name&&e.push(s),s=i.getNext();return e.push(t),Ra(e,r.getCompare())}return Aa}{const e=n.get(t.name);let s=i;return e&&(s=s.remove(new ca(t.name,e))),s.insert(t,t.node)}}));return new Da(i,this.indexSet_)}removeFromIndexes(t,e){const n=T(this.indexes_,(n=>{if(n===Aa)return n;{const i=e.get(t.name);return i?n.remove(new ca(t.name,i)):n}}));return new Da(n,this.indexSet_)}}let Oa;class La{constructor(t,n,i){this.children_=t,this.priorityNode_=n,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&ba(this.priorityNode_),this.children_.isEmpty()&&e(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Oa||(Oa=new La(new ma(va),null,Da.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Oa}updatePriority(t){return this.children_.isEmpty()?this:new La(this.children_,t,this.indexMap_)}getImmediateChild(t){if(".priority"===t)return this.getPriority();{const e=this.children_.get(t);return null===e?Oa:e}}getChild(t){const e=Yo(t);return null===e?this:this.getImmediateChild(e).getChild(Go(t))}hasChild(t){return null!==this.children_.get(t)}updateImmediateChild(t,n){if(e(n,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(n);{const e=new ca(t,n);let i,s;n.isEmpty()?(i=this.children_.remove(t),s=this.indexMap_.removeFromIndexes(e,this.children_)):(i=this.children_.insert(t,n),s=this.indexMap_.addToIndexes(e,this.children_));const r=i.isEmpty()?Oa:this.priorityNode_;return new La(i,r,s)}}updateChild(t,n){const i=Yo(t);if(null===i)return n;{e(".priority"!==Yo(t)||1===Ko(t),".priority must be the last token in a path");const s=this.getImmediateChild(i).updateChild(Go(t),n);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const e={};let n=0,i=0,s=!0;if(this.forEachChild(ka,((r,o)=>{e[r]=o.val(t),n++,s&&La.INTEGER_REGEXP_.test(r)?i=Math.max(i,Number(r)):s=!1})),!t&&s&&i<2*n){const t=[];for(const n in e)t[n]=e[n];return t}return t&&!this.getPriority().isEmpty()&&(e[".priority"]=this.getPriority().val()),e}hash(){if(null===this.lazyHash_){let t="";this.getPriority().isEmpty()||(t+="priority:"+Ca(this.getPriority().val())+":"),this.forEachChild(ka,((e,n)=>{const i=n.hash();""!==i&&(t+=":"+e+":"+i)})),this.lazyHash_=""===t?"":Xr(t)}return this.lazyHash_}getPredecessorChildName(t,e,n){const i=this.resolveIndex_(n);if(i){const n=i.getPredecessorKey(new ca(t,e));return n?n.name:null}return this.children_.getPredecessorKey(t)}getFirstChildName(t){const e=this.resolveIndex_(t);if(e){const t=e.minKey();return t&&t.name}return this.children_.minKey()}getFirstChild(t){const e=this.getFirstChildName(t);return e?new ca(e,this.children_.get(e)):null}getLastChildName(t){const e=this.resolveIndex_(t);if(e){const t=e.maxKey();return t&&t.name}return this.children_.maxKey()}getLastChild(t){const e=this.getLastChildName(t);return e?new ca(e,this.children_.get(e)):null}forEachChild(t,e){const n=this.resolveIndex_(t);return n?n.inorderTraversal((t=>e(t.name,t.node))):this.children_.inorderTraversal(e)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,e){const n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,(t=>t));{const n=this.children_.getIteratorFrom(t.name,ca.Wrap);let i=n.peek();for(;null!=i&&e.compare(i,t)<0;)n.getNext(),i=n.peek();return n}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,e){const n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,(t=>t));{const n=this.children_.getReverseIteratorFrom(t.name,ca.Wrap);let i=n.peek();for(;null!=i&&e.compare(i,t)>0;)n.getNext(),i=n.peek();return n}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Ma?-1:0}withIndex(t){if(t===fa||this.indexMap_.hasIndex(t))return this;{const e=this.indexMap_.addIndex(t,this.children_);return new La(this.children_,this.priorityNode_,e)}}isIndexed(t){return t===fa||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{const e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()===e.children_.count()){const t=this.getIterator(ka),n=e.getIterator(ka);let i=t.getNext(),s=n.getNext();for(;i&&s;){if(i.name!==s.name||!i.node.equals(s.node))return!1;i=t.getNext(),s=n.getNext()}return null===i&&null===s}return!1}return!1}}resolveIndex_(t){return t===fa?null:this.indexMap_.get(t.toString())}}La.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const Ma=new class extends La{constructor(){super(new ma(va),La.EMPTY_NODE,Da.Default)}compareTo(t){return t===this?0:1}equals(t){return t===this}getPriority(){return this}getImmediateChild(t){return La.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(ca,{MIN:{value:new ca(oo,La.EMPTY_NODE)},MAX:{value:new ca(ao,Ma)}}),pa.__EMPTY_NODE=La.EMPTY_NODE,Sa.__childrenNodeConstructor=La,wa=Ma,Ia=Ma;const Fa=!0;function qa(t,n=null){if(null===t)return La.EMPTY_NODE;if("object"==typeof t&&".priority"in t&&(n=t[".priority"]),e(null===n||"string"==typeof n||"number"==typeof n||"object"==typeof n&&".sv"in n,"Invalid priority type found: "+typeof n),"object"==typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!=typeof t||".sv"in t)return new Sa(t,qa(n));if(t instanceof Array||!Fa){let e=La.EMPTY_NODE;return fo(t,((n,i)=>{if(C(t,n)&&"."!==n.substring(0,1)){const t=qa(i);!t.isLeafNode()&&t.isEmpty()||(e=e.updateImmediateChild(n,t))}})),e.updatePriority(qa(n))}{const e=[];let i=!1;if(fo(t,((t,n)=>{if("."!==t.substring(0,1)){const s=qa(n);s.isEmpty()||(i=i||!s.getPriority().isEmpty(),e.push(new ca(t,s)))}})),0===e.length)return La.EMPTY_NODE;const s=Ra(e,ya,(t=>t.name),va);if(i){const t=Ra(e,ka.getCompare());return new La(s,qa(n),new Da({".priority":t},{".priority":ka}))}return new La(s,qa(n),Da.Default)}}!function(t){Ta=t}(qa);class Ua extends ua{constructor(t){super(),this.indexPath_=t,e(!ta(t)&&".priority"!==Yo(t),"Can't create PathIndex with empty path or .priority key")}extractChild(t){return t.getChild(this.indexPath_)}isDefinedOn(t){return!t.getChild(this.indexPath_).isEmpty()}compare(t,e){const n=this.extractChild(t.node),i=this.extractChild(e.node),s=n.compareTo(i);return 0===s?ho(t.name,e.name):s}makePost(t,e){const n=qa(t),i=La.EMPTY_NODE.updateChild(this.indexPath_,n);return new ca(e,i)}maxPost(){const t=La.EMPTY_NODE.updateChild(this.indexPath_,Ma);return new ca(ao,t)}toString(){return Qo(this.indexPath_,0).join("/")}}const ja=new class extends ua{compare(t,e){const n=t.node.compareTo(e.node);return 0===n?ho(t.name,e.name):n}isDefinedOn(t){return!0}indexedValueChanged(t,e){return!t.equals(e)}minPost(){return ca.MIN}maxPost(){return ca.MAX}makePost(t,e){const n=qa(t);return new ca(e,n)}toString(){return".value"}};function Ba(t){return{type:"value",snapshotNode:t}}function Ha(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function za(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Wa(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}class Va{constructor(t){this.index_=t}updateChild(t,n,i,s,r,o){e(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=t.getImmediateChild(n);return a.getChild(s).equals(i.getChild(s))&&a.isEmpty()===i.isEmpty()?t:(null!=o&&(i.isEmpty()?t.hasChild(n)?o.trackChildChange(za(n,a)):e(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Ha(n,i)):o.trackChildChange(Wa(n,i,a))),t.isLeafNode()&&i.isEmpty()?t:t.updateImmediateChild(n,i).withIndex(this.index_))}updateFullNode(t,e,n){return null!=n&&(t.isLeafNode()||t.forEachChild(ka,((t,i)=>{e.hasChild(t)||n.trackChildChange(za(t,i))})),e.isLeafNode()||e.forEachChild(ka,((e,i)=>{if(t.hasChild(e)){const s=t.getImmediateChild(e);s.equals(i)||n.trackChildChange(Wa(e,i,s))}else n.trackChildChange(Ha(e,i))}))),e.withIndex(this.index_)}updatePriority(t,e){return t.isEmpty()?La.EMPTY_NODE:t.updatePriority(e)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class $a{constructor(t){this.indexedFilter_=new Va(t.getIndex()),this.index_=t.getIndex(),this.startPost_=$a.getStartPost_(t),this.endPost_=$a.getEndPost_(t),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(t){const e=this.startIsInclusive_?this.index_.compare(this.getStartPost(),t)<=0:this.index_.compare(this.getStartPost(),t)<0,n=this.endIsInclusive_?this.index_.compare(t,this.getEndPost())<=0:this.index_.compare(t,this.getEndPost())<0;return e&&n}updateChild(t,e,n,i,s,r){return this.matches(new ca(e,n))||(n=La.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,i,s,r)}updateFullNode(t,e,n){e.isLeafNode()&&(e=La.EMPTY_NODE);let i=e.withIndex(this.index_);i=i.updatePriority(La.EMPTY_NODE);const s=this;return e.forEachChild(ka,((t,e)=>{s.matches(new ca(t,e))||(i=i.updateImmediateChild(t,La.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(t,i,n)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(t){if(t.hasStart()){const e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()}static getEndPost_(t){if(t.hasEnd()){const e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()}}class Ya{constructor(t){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const e=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?e<=0:e<0},this.withinEndPost=t=>{const e=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?e<=0:e<0},this.rangedFilter_=new $a(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft(),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}updateChild(t,e,n,i,s,r){return this.rangedFilter_.matches(new ca(e,n))||(n=La.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,i,s,r):this.fullLimitUpdateChild_(t,e,n,s,r)}updateFullNode(t,e,n){let i;if(e.isLeafNode()||e.isEmpty())i=La.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){let t;i=La.EMPTY_NODE.withIndex(this.index_),t=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;t.hasNext()&&n<this.limit_;){const e=t.getNext();if(this.withinDirectionalStart(e)){if(!this.withinDirectionalEnd(e))break;i=i.updateImmediateChild(e.name,e.node),n++}}}else{let t;i=e.withIndex(this.index_),i=i.updatePriority(La.EMPTY_NODE),t=this.reverse_?i.getReverseIterator(this.index_):i.getIterator(this.index_);let n=0;for(;t.hasNext();){const e=t.getNext();n<this.limit_&&this.withinDirectionalStart(e)&&this.withinDirectionalEnd(e)?n++:i=i.updateImmediateChild(e.name,La.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,i,n)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(t,n,i,s,r){let o;if(this.reverse_){const t=this.index_.getCompare();o=(e,n)=>t(n,e)}else o=this.index_.getCompare();const a=t;e(a.numChildren()===this.limit_,"");const h=new ca(n,i),l=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),c=this.rangedFilter_.matches(h);if(a.hasChild(n)){const t=a.getImmediateChild(n);let e=s.getChildAfterChild(this.index_,l,this.reverse_);for(;null!=e&&(e.name===n||a.hasChild(e.name));)e=s.getChildAfterChild(this.index_,e,this.reverse_);const u=null==e?1:o(e,h);if(c&&!i.isEmpty()&&u>=0)return null!=r&&r.trackChildChange(Wa(n,i,t)),a.updateImmediateChild(n,i);{null!=r&&r.trackChildChange(za(n,t));const i=a.updateImmediateChild(n,La.EMPTY_NODE);return null!=e&&this.rangedFilter_.matches(e)?(null!=r&&r.trackChildChange(Ha(e.name,e.node)),i.updateImmediateChild(e.name,e.node)):i}}return i.isEmpty()?t:c&&o(l,h)>=0?(null!=r&&(r.trackChildChange(za(l.name,l.node)),r.trackChildChange(Ha(n,i))),a.updateImmediateChild(n,i).updateImmediateChild(l.name,La.EMPTY_NODE)):t}}class Ka{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ka}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return e(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return e(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:oo}hasEnd(){return this.endSet_}getIndexEndValue(){return e(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return e(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ao}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return e(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===ka}copy(){const t=new Ka;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.startAfterSet_=this.startAfterSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.endBeforeSet_=this.endBeforeSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}}function Ga(t){const n={};if(t.isDefault())return n;let i;if(t.index_===ka?i="$priority":t.index_===ja?i="$value":t.index_===fa?i="$key":(e(t.index_ instanceof Ua,"Unrecognized index type!"),i=t.index_.toString()),n.orderBy=v(i),t.startSet_){const e=t.startAfterSet_?"startAfter":"startAt";n[e]=v(t.indexStartValue_),t.startNameSet_&&(n[e]+=","+v(t.indexStartName_))}if(t.endSet_){const e=t.endBeforeSet_?"endBefore":"endAt";n[e]=v(t.indexEndValue_),t.endNameSet_&&(n[e]+=","+v(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?n.limitToFirst=t.limit_:n.limitToLast=t.limit_),n}function Xa(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;""===n&&(n=t.isViewFromLeft()?"l":"r"),e.vf=n}return t.index_!==ka&&(e.i=t.index_.toString()),e}class Qa extends Ho{constructor(t,e,n,i){super(),this.repoInfo_=t,this.onDataUpdate_=e,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=eo("p:rest:"),this.listens_={}}reportStats(t){throw new Error("Method not implemented.")}static getListenId_(t,n){return void 0!==n?"tag$"+n:(e(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())}listen(t,e,n,i){const s=t._path.toString();this.log_("Listen called for "+s+" "+t._queryIdentifier);const r=Qa.getListenId_(t,n),o={};this.listens_[r]=o;const a=Ga(t._queryParams);this.restRequest_(s+".json",a,((t,e)=>{let a=e;if(404===t&&(a=null,t=null),null===t&&this.onDataUpdate_(s,a,!1,n),b(this.listens_,r)===o){let e;e=t?401===t?"permission_denied":"rest_error:"+t:"ok",i(e,null)}}))}unlisten(t,e){const n=Qa.getListenId_(t,e);delete this.listens_[n]}get(t){const e=Ga(t._queryParams),n=t._path.toString(),i=new p;return this.restRequest_(n+".json",e,((t,e)=>{let s=e;404===t&&(s=null,t=null),null===t?(this.onDataUpdate_(n,s,!1,null),i.resolve(s)):i.reject(new Error(s))})),i.promise}refreshAuthToken(t){}restRequest_(t,e={},n){return e.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([i,s])=>{i&&i.accessToken&&(e.auth=i.accessToken),s&&s.token&&(e.ac=s.token);const r=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+t+"?ns="+this.repoInfo_.namespace+function(t){const e=[];for(const[n,i]of Object.entries(t))Array.isArray(i)?i.forEach((t=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(t))})):e.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}(e);this.log_("Sending REST request for "+r);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+r+" received. status:",o.status,"response:",o.responseText);let t=null;if(o.status>=200&&o.status<300){try{t=y(o.responseText)}catch(t){so("Failed to parse JSON response for "+r+": "+o.responseText)}n(null,t)}else 401!==o.status&&404!==o.status&&so("Got unsuccessful REST response for "+r+" Status: "+o.status),n(o.status);n=null}},o.open("GET",r,!0),o.send()}))}}class Ja{constructor(){this.rootNode_=La.EMPTY_NODE}getNode(t){return this.rootNode_.getChild(t)}updateSnapshot(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)}}function Za(){return{value:null,children:new Map}}function th(t,e,n){if(ta(e))t.value=n,t.children.clear();else if(null!==t.value)t.value=t.value.updateChild(e,n);else{const i=Yo(e);t.children.has(i)||t.children.set(i,Za()),th(t.children.get(i),e=Go(e),n)}}function eh(t,e,n){null!==t.value?n(e,t.value):function(t,e){t.children.forEach(((t,n)=>{e(n,t)}))}(t,((t,i)=>{eh(i,new Vo(e.toString()+"/"+t),n)}))}class nh{constructor(t){this.collection_=t,this.last_=null}get(){const t=this.collection_.get(),e=Object.assign({},t);return this.last_&&fo(this.last_,((t,n)=>{e[t]=e[t]-n})),this.last_=t,e}}class ih{constructor(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new nh(t);const n=1e4+2e4*Math.random();vo(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const t=this.statsListener_.get(),e={};let n=!1;fo(t,((t,i)=>{i>0&&C(this.statsToReport_,t)&&(e[t]=i,n=!0)})),n&&this.server_.reportStats(e),vo(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var sh;function rh(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}!function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(sh||(sh={}));class oh{constructor(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=sh.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(t){if(ta(this.path)){if(null!=this.affectedTree.value)return e(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const e=this.affectedTree.subtree(new Vo(t));return new oh($o(),e,this.revert)}}return e(Yo(this.path)===t,"operationForChild called for unrelated child."),new oh(Go(this.path),this.affectedTree,this.revert)}}class ah{constructor(t,e){this.source=t,this.path=e,this.type=sh.LISTEN_COMPLETE}operationForChild(t){return ta(this.path)?new ah(this.source,$o()):new ah(this.source,Go(this.path))}}class hh{constructor(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=sh.OVERWRITE}operationForChild(t){return ta(this.path)?new hh(this.source,$o(),this.snap.getImmediateChild(t)):new hh(this.source,Go(this.path),this.snap)}}class lh{constructor(t,e,n){this.source=t,this.path=e,this.children=n,this.type=sh.MERGE}operationForChild(t){if(ta(this.path)){const e=this.children.subtree(new Vo(t));return e.isEmpty()?null:e.value?new hh(this.source,$o(),e.value):new lh(this.source,$o(),e)}return e(Yo(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new lh(this.source,Go(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class ch{constructor(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(t){if(ta(t))return this.isFullyInitialized()&&!this.filtered_;const e=Yo(t);return this.isCompleteForChild(e)}isCompleteForChild(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)}getNode(){return this.node_}}class uh{constructor(t){this.query_=t,this.index_=this.query_._queryParams.getIndex()}}function dh(t,e,i,s,r,o){const a=s.filter((t=>t.type===i));a.sort(((e,i)=>function(t,e,i){if(null==e.childName||null==i.childName)throw n("Should only compare child_ events.");const s=new ca(e.childName,e.snapshotNode),r=new ca(i.childName,i.snapshotNode);return t.index_.compare(s,r)}(t,e,i))),a.forEach((n=>{const i=function(t,e,n){return"value"===e.type||"child_removed"===e.type||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}(t,n,o);r.forEach((s=>{s.respondsTo(n.type)&&e.push(s.createEvent(i,t.query_))}))}))}function ph(t,e){return{eventCache:t,serverCache:e}}function fh(t,e,n,i){return ph(new ch(e,n,i),t.serverCache)}function gh(t,e,n,i){return ph(t.eventCache,new ch(e,n,i))}function _h(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function mh(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}let yh;class vh{constructor(t,e=(()=>(yh||(yh=new ma(lo)),yh))()){this.value=t,this.children=e}static fromObject(t){let e=new vh(null);return fo(t,((t,n)=>{e=e.set(new Vo(t),n)})),e}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(t,e){if(null!=this.value&&e(this.value))return{path:$o(),value:this.value};if(ta(t))return null;{const n=Yo(t),i=this.children.get(n);if(null!==i){const s=i.findRootMostMatchingPathAndValue(Go(t),e);return null!=s?{path:Zo(new Vo(n),s.path),value:s.value}:null}return null}}findRootMostValueAndPath(t){return this.findRootMostMatchingPathAndValue(t,(()=>!0))}subtree(t){if(ta(t))return this;{const e=Yo(t),n=this.children.get(e);return null!==n?n.subtree(Go(t)):new vh(null)}}set(t,e){if(ta(t))return new vh(e,this.children);{const n=Yo(t),i=(this.children.get(n)||new vh(null)).set(Go(t),e),s=this.children.insert(n,i);return new vh(this.value,s)}}remove(t){if(ta(t))return this.children.isEmpty()?new vh(null):new vh(null,this.children);{const e=Yo(t),n=this.children.get(e);if(n){const i=n.remove(Go(t));let s;return s=i.isEmpty()?this.children.remove(e):this.children.insert(e,i),null===this.value&&s.isEmpty()?new vh(null):new vh(this.value,s)}return this}}get(t){if(ta(t))return this.value;{const e=Yo(t),n=this.children.get(e);return n?n.get(Go(t)):null}}setTree(t,e){if(ta(t))return e;{const n=Yo(t),i=(this.children.get(n)||new vh(null)).setTree(Go(t),e);let s;return s=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),new vh(this.value,s)}}fold(t){return this.fold_($o(),t)}fold_(t,e){const n={};return this.children.inorderTraversal(((i,s)=>{n[i]=s.fold_(Zo(t,i),e)})),e(t,this.value,n)}findOnPath(t,e){return this.findOnPath_(t,$o(),e)}findOnPath_(t,e,n){const i=!!this.value&&n(e,this.value);if(i)return i;if(ta(t))return null;{const i=Yo(t),s=this.children.get(i);return s?s.findOnPath_(Go(t),Zo(e,i),n):null}}foreachOnPath(t,e){return this.foreachOnPath_(t,$o(),e)}foreachOnPath_(t,e,n){if(ta(t))return this;{this.value&&n(e,this.value);const i=Yo(t),s=this.children.get(i);return s?s.foreachOnPath_(Go(t),Zo(e,i),n):new vh(null)}}foreach(t){this.foreach_($o(),t)}foreach_(t,e){this.children.inorderTraversal(((n,i)=>{i.foreach_(Zo(t,n),e)})),this.value&&e(t,this.value)}foreachChild(t){this.children.inorderTraversal(((e,n)=>{n.value&&t(e,n.value)}))}}class wh{constructor(t){this.writeTree_=t}static empty(){return new wh(new vh(null))}}function Ch(t,e,n){if(ta(e))return new wh(new vh(n));{const i=t.writeTree_.findRootMostValueAndPath(e);if(null!=i){const s=i.path;let r=i.value;const o=ea(s,e);return r=r.updateChild(o,n),new wh(t.writeTree_.set(s,r))}{const i=new vh(n),s=t.writeTree_.setTree(e,i);return new wh(s)}}}function bh(t,e,n){let i=t;return fo(n,((t,n)=>{i=Ch(i,Zo(e,t),n)})),i}function Eh(t,e){if(ta(e))return wh.empty();{const n=t.writeTree_.setTree(e,new vh(null));return new wh(n)}}function Th(t,e){return null!=Ih(t,e)}function Ih(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return null!=n?t.writeTree_.get(n.path).getChild(ea(n.path,e)):null}function Sh(t){const e=[],n=t.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(ka,((t,n)=>{e.push(new ca(t,n))})):t.writeTree_.children.inorderTraversal(((t,n)=>{null!=n.value&&e.push(new ca(t,n.value))})),e}function kh(t,e){if(ta(e))return t;{const n=Ih(t,e);return new wh(null!=n?new vh(n):t.writeTree_.subtree(e))}}function Nh(t){return t.writeTree_.isEmpty()}function Ph(t,e){return Rh($o(),t.writeTree_,e)}function Rh(t,n,i){if(null!=n.value)return i.updateChild(t,n.value);{let s=null;return n.children.inorderTraversal(((n,r)=>{".priority"===n?(e(null!==r.value,"Priority writes must always be leaf nodes"),s=r.value):i=Rh(Zo(t,n),r,i)})),i.getChild(t).isEmpty()||null===s||(i=i.updateChild(Zo(t,".priority"),s)),i}}function xh(t,e){return Hh(e,t)}function Ah(t,e){if(t.snap)return ia(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&ia(Zo(t.path,n),e))return!0;return!1}function Dh(t){return t.visible}function Oh(t,e,i){let s=wh.empty();for(let r=0;r<t.length;++r){const o=t[r];if(e(o)){const t=o.path;let e;if(o.snap)ia(i,t)?(e=ea(i,t),s=Ch(s,e,o.snap)):ia(t,i)&&(e=ea(t,i),s=Ch(s,$o(),o.snap.getChild(e)));else{if(!o.children)throw n("WriteRecord should have .snap or .children");if(ia(i,t))e=ea(i,t),s=bh(s,e,o.children);else if(ia(t,i))if(e=ea(t,i),ta(e))s=bh(s,$o(),o.children);else{const t=b(o.children,Yo(e));if(t){const n=t.getChild(Go(e));s=Ch(s,$o(),n)}}}}}return s}function Lh(t,e,n,i,s){if(i||s){const r=kh(t.visibleWrites,e);if(!s&&Nh(r))return n;if(s||null!=n||Th(r,$o())){const r=function(t){return(t.visible||s)&&(!i||!~i.indexOf(t.writeId))&&(ia(t.path,e)||ia(e,t.path))};return Ph(Oh(t.allWrites,r,e),n||La.EMPTY_NODE)}return null}{const i=Ih(t.visibleWrites,e);if(null!=i)return i;{const i=kh(t.visibleWrites,e);return Nh(i)?n:null!=n||Th(i,$o())?Ph(i,n||La.EMPTY_NODE):null}}}function Mh(t,e,n,i){return Lh(t.writeTree,t.treePath,e,n,i)}function Fh(t,e){return function(t,e,n){let i=La.EMPTY_NODE;const s=Ih(t.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(ka,((t,e)=>{i=i.updateImmediateChild(t,e)})),i;if(n){const s=kh(t.visibleWrites,e);return n.forEachChild(ka,((t,e)=>{const n=Ph(kh(s,new Vo(t)),e);i=i.updateImmediateChild(t,n)})),Sh(s).forEach((t=>{i=i.updateImmediateChild(t.name,t.node)})),i}return Sh(kh(t.visibleWrites,e)).forEach((t=>{i=i.updateImmediateChild(t.name,t.node)})),i}(t.writeTree,t.treePath,e)}function qh(t,n,i,s){return function(t,n,i,s,r){e(s||r,"Either existingEventSnap or existingServerSnap must exist");const o=Zo(n,i);if(Th(t.visibleWrites,o))return null;{const e=kh(t.visibleWrites,o);return Nh(e)?r.getChild(i):Ph(e,r.getChild(i))}}(t.writeTree,t.treePath,n,i,s)}function Uh(t,e){return function(t,e){return Ih(t.visibleWrites,e)}(t.writeTree,Zo(t.treePath,e))}function jh(t,e,n){return function(t,e,n,i){const s=Zo(e,n),r=Ih(t.visibleWrites,s);return null!=r?r:i.isCompleteForChild(n)?Ph(kh(t.visibleWrites,s),i.getNode().getImmediateChild(n)):null}(t.writeTree,t.treePath,e,n)}function Bh(t,e){return Hh(Zo(t.treePath,e),t.writeTree)}function Hh(t,e){return{treePath:t,writeTree:e}}class zh{constructor(){this.changeMap=new Map}trackChildChange(t){const i=t.type,s=t.childName;e("child_added"===i||"child_changed"===i||"child_removed"===i,"Only child changes supported for tracking"),e(".priority"!==s,"Only non-priority child changes can be tracked.");const r=this.changeMap.get(s);if(r){const e=r.type;if("child_added"===i&&"child_removed"===e)this.changeMap.set(s,Wa(s,t.snapshotNode,r.snapshotNode));else if("child_removed"===i&&"child_added"===e)this.changeMap.delete(s);else if("child_removed"===i&&"child_changed"===e)this.changeMap.set(s,za(s,r.oldSnap));else if("child_changed"===i&&"child_added"===e)this.changeMap.set(s,Ha(s,t.snapshotNode));else{if("child_changed"!==i||"child_changed"!==e)throw n("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap.set(s,Wa(s,t.snapshotNode,r.oldSnap))}}else this.changeMap.set(s,t)}getChanges(){return Array.from(this.changeMap.values())}}const Wh=new class{getCompleteChild(t){return null}getChildAfterChild(t,e,n){return null}};class Vh{constructor(t,e,n=null){this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}getCompleteChild(t){const e=this.viewCache_.eventCache;if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);{const e=null!=this.optCompleteServerCache_?new ch(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return jh(this.writes_,t,e)}}getChildAfterChild(t,e,n){const i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:mh(this.viewCache_),s=function(t,e,n,i,s,r){return function(t,e,n,i,s,r,o){let a;const h=kh(t.visibleWrites,e),l=Ih(h,$o());if(null!=l)a=l;else{if(null==n)return[];a=Ph(h,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const t=[],e=o.getCompare(),n=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let h=n.getNext();for(;h&&t.length<s;)0!==e(h,i)&&t.push(h),h=n.getNext();return t}}(t.writeTree,t.treePath,e,n,i,s,r)}(this.writes_,i,e,1,n,t);return 0===s.length?null:s[0]}}function $h(t,n,i,s,r,o){const a=n.eventCache;if(null!=Uh(s,i))return n;{let h,l;if(ta(i))if(e(n.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),n.serverCache.isFiltered()){const e=mh(n),i=Fh(s,e instanceof La?e:La.EMPTY_NODE);h=t.filter.updateFullNode(n.eventCache.getNode(),i,o)}else{const e=Mh(s,mh(n));h=t.filter.updateFullNode(n.eventCache.getNode(),e,o)}else{const c=Yo(i);if(".priority"===c){e(1===Ko(i),"Can't have a priority with additional path components");const r=a.getNode();l=n.serverCache.getNode();const o=qh(s,i,r,l);h=null!=o?t.filter.updatePriority(r,o):a.getNode()}else{const e=Go(i);let u;if(a.isCompleteForChild(c)){l=n.serverCache.getNode();const t=qh(s,i,a.getNode(),l);u=null!=t?a.getNode().getImmediateChild(c).updateChild(e,t):a.getNode().getImmediateChild(c)}else u=jh(s,c,n.serverCache);h=null!=u?t.filter.updateChild(a.getNode(),c,u,e,r,o):a.getNode()}}return fh(n,h,a.isFullyInitialized()||ta(i),t.filter.filtersNodes())}}function Yh(t,e,n,i,s,r,o,a){const h=e.serverCache;let l;const c=o?t.filter:t.filter.getIndexedFilter();if(ta(n))l=c.updateFullNode(h.getNode(),i,null);else if(c.filtersNodes()&&!h.isFiltered()){const t=h.getNode().updateChild(n,i);l=c.updateFullNode(h.getNode(),t,null)}else{const t=Yo(n);if(!h.isCompleteForPath(n)&&Ko(n)>1)return e;const s=Go(n),r=h.getNode().getImmediateChild(t).updateChild(s,i);l=".priority"===t?c.updatePriority(h.getNode(),r):c.updateChild(h.getNode(),t,r,s,Wh,null)}const u=gh(e,l,h.isFullyInitialized()||ta(n),c.filtersNodes());return $h(t,u,n,s,new Vh(s,u,r),a)}function Kh(t,e,n,i,s,r,o){const a=e.eventCache;let h,l;const c=new Vh(s,e,r);if(ta(n))l=t.filter.updateFullNode(e.eventCache.getNode(),i,o),h=fh(e,l,!0,t.filter.filtersNodes());else{const s=Yo(n);if(".priority"===s)l=t.filter.updatePriority(e.eventCache.getNode(),i),h=fh(e,l,a.isFullyInitialized(),a.isFiltered());else{const r=Go(n),l=a.getNode().getImmediateChild(s);let u;if(ta(r))u=i;else{const t=c.getCompleteChild(s);u=null!=t?".priority"===Xo(r)&&t.getChild(Jo(r)).isEmpty()?t:t.updateChild(r,i):La.EMPTY_NODE}h=l.equals(u)?e:fh(e,t.filter.updateChild(a.getNode(),s,u,r,c,o),a.isFullyInitialized(),t.filter.filtersNodes())}}return h}function Gh(t,e){return t.eventCache.isCompleteForChild(e)}function Xh(t,e,n){return n.foreach(((t,n)=>{e=e.updateChild(t,n)})),e}function Qh(t,e,n,i,s,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let h,l=e;h=ta(n)?i:new vh(null).setTree(n,i);const c=e.serverCache.getNode();return h.children.inorderTraversal(((n,i)=>{if(c.hasChild(n)){const h=Xh(0,e.serverCache.getNode().getImmediateChild(n),i);l=Yh(t,l,new Vo(n),h,s,r,o,a)}})),h.children.inorderTraversal(((n,i)=>{const h=!e.serverCache.isCompleteForChild(n)&&null===i.value;if(!c.hasChild(n)&&!h){const h=Xh(0,e.serverCache.getNode().getImmediateChild(n),i);l=Yh(t,l,new Vo(n),h,s,r,o,a)}})),l}class Jh{constructor(t,e){this.query_=t,this.eventRegistrations_=[];const n=this.query_._queryParams,i=new Va(n.getIndex()),s=(r=n).loadsAllData()?new Va(r.getIndex()):r.hasLimit()?new Ya(r):new $a(r);var r;this.processor_=function(t){return{filter:t}}(s);const o=e.serverCache,a=e.eventCache,h=i.updateFullNode(La.EMPTY_NODE,o.getNode(),null),l=s.updateFullNode(La.EMPTY_NODE,a.getNode(),null),c=new ch(h,o.isFullyInitialized(),i.filtersNodes()),u=new ch(l,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=ph(u,c),this.eventGenerator_=new uh(this.query_)}get query(){return this.query_}}function Zh(t,e){const n=mh(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!ta(e)&&!n.getImmediateChild(Yo(e)).isEmpty())?n.getChild(e):null}function tl(t){return 0===t.eventRegistrations_.length}function el(t,n,i){const s=[];if(i){e(null==n,"A cancel should cancel all event registrations.");const r=t.query._path;t.eventRegistrations_.forEach((t=>{const e=t.createCancelEvent(i,r);e&&s.push(e)}))}if(n){let e=[];for(let i=0;i<t.eventRegistrations_.length;++i){const s=t.eventRegistrations_[i];if(s.matches(n)){if(n.hasAnyCallback()){e=e.concat(t.eventRegistrations_.slice(i+1));break}}else e.push(s)}t.eventRegistrations_=e}else t.eventRegistrations_=[];return s}function nl(t,i,s,r){i.type===sh.MERGE&&null!==i.source.queryId&&(e(mh(t.viewCache_),"We should always have a full cache before handling merges"),e(_h(t.viewCache_),"Missing event cache, even though we have a server cache"));const o=t.viewCache_,a=function(t,i,s,r,o){const a=new zh;let h,l;if(s.type===sh.OVERWRITE){const n=s;n.source.fromUser?h=Kh(t,i,n.path,n.snap,r,o,a):(e(n.source.fromServer,"Unknown source."),l=n.source.tagged||i.serverCache.isFiltered()&&!ta(n.path),h=Yh(t,i,n.path,n.snap,r,o,l,a))}else if(s.type===sh.MERGE){const n=s;n.source.fromUser?h=function(t,e,n,i,s,r,o){let a=e;return i.foreach(((i,h)=>{const l=Zo(n,i);Gh(e,Yo(l))&&(a=Kh(t,a,l,h,s,r,o))})),i.foreach(((i,h)=>{const l=Zo(n,i);Gh(e,Yo(l))||(a=Kh(t,a,l,h,s,r,o))})),a}(t,i,n.path,n.children,r,o,a):(e(n.source.fromServer,"Unknown source."),l=n.source.tagged||i.serverCache.isFiltered(),h=Qh(t,i,n.path,n.children,r,o,l,a))}else if(s.type===sh.ACK_USER_WRITE){const n=s;h=n.revert?function(t,n,i,s,r,o){let a;if(null!=Uh(s,i))return n;{const h=new Vh(s,n,r),l=n.eventCache.getNode();let c;if(ta(i)||".priority"===Yo(i)){let i;if(n.serverCache.isFullyInitialized())i=Mh(s,mh(n));else{const t=n.serverCache.getNode();e(t instanceof La,"serverChildren would be complete if leaf node"),i=Fh(s,t)}c=t.filter.updateFullNode(l,i,o)}else{const e=Yo(i);let r=jh(s,e,n.serverCache);null==r&&n.serverCache.isCompleteForChild(e)&&(r=l.getImmediateChild(e)),c=null!=r?t.filter.updateChild(l,e,r,Go(i),h,o):n.eventCache.getNode().hasChild(e)?t.filter.updateChild(l,e,La.EMPTY_NODE,Go(i),h,o):l,c.isEmpty()&&n.serverCache.isFullyInitialized()&&(a=Mh(s,mh(n)),a.isLeafNode()&&(c=t.filter.updateFullNode(c,a,o)))}return a=n.serverCache.isFullyInitialized()||null!=Uh(s,$o()),fh(n,c,a,t.filter.filtersNodes())}}(t,i,n.path,r,o,a):function(t,e,n,i,s,r,o){if(null!=Uh(s,n))return e;const a=e.serverCache.isFiltered(),h=e.serverCache;if(null!=i.value){if(ta(n)&&h.isFullyInitialized()||h.isCompleteForPath(n))return Yh(t,e,n,h.getNode().getChild(n),s,r,a,o);if(ta(n)){let i=new vh(null);return h.getNode().forEachChild(fa,((t,e)=>{i=i.set(new Vo(t),e)})),Qh(t,e,n,i,s,r,a,o)}return e}{let l=new vh(null);return i.foreach(((t,e)=>{const i=Zo(n,t);h.isCompleteForPath(i)&&(l=l.set(t,h.getNode().getChild(i)))})),Qh(t,e,n,l,s,r,a,o)}}(t,i,n.path,n.affectedTree,r,o,a)}else{if(s.type!==sh.LISTEN_COMPLETE)throw n("Unknown operation type: "+s.type);h=function(t,e,n,i,s){const r=e.serverCache;return $h(t,gh(e,r.getNode(),r.isFullyInitialized()||ta(n),r.isFiltered()),n,i,Wh,s)}(t,i,s.path,r,a)}const c=a.getChanges();return function(t,e,n){const i=e.eventCache;if(i.isFullyInitialized()){const s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=_h(t);(n.length>0||!t.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&n.push(Ba(_h(e)))}}(i,h,c),{viewCache:h,changes:c}}(t.processor_,o,i,s,r);var h,l;return h=t.processor_,l=a.viewCache,e(l.eventCache.getNode().isIndexed(h.filter.getIndex()),"Event snap not indexed"),e(l.serverCache.getNode().isIndexed(h.filter.getIndex()),"Server snap not indexed"),e(a.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=a.viewCache,il(t,a.changes,a.viewCache.eventCache.getNode(),null)}function il(t,e,n,i){const s=i?[i]:t.eventRegistrations_;return function(t,e,n,i){const s=[],r=[];return e.forEach((e=>{var n;"child_changed"===e.type&&t.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&r.push((n=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:n}))})),dh(t,s,"child_removed",e,i,n),dh(t,s,"child_added",e,i,n),dh(t,s,"child_moved",r,i,n),dh(t,s,"child_changed",e,i,n),dh(t,s,"value",e,i,n),s}(t.eventGenerator_,e,n,s)}let sl,rl;class ol{constructor(){this.views=new Map}}function al(t,n,i,s){const r=n.source.queryId;if(null!==r){const o=t.views.get(r);return e(null!=o,"SyncTree gave us an op for an invalid query."),nl(o,n,i,s)}{let e=[];for(const r of t.views.values())e=e.concat(nl(r,n,i,s));return e}}function hl(t,e,n,i,s){const r=e._queryIdentifier,o=t.views.get(r);if(!o){let t=Mh(n,s?i:null),r=!1;t?r=!0:i instanceof La?(t=Fh(n,i),r=!1):(t=La.EMPTY_NODE,r=!1);const o=ph(new ch(t,r,!1),new ch(i,s,!1));return new Jh(e,o)}return o}function ll(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function cl(t,e){let n=null;for(const i of t.views.values())n=n||Zh(i,e);return n}function ul(t,e){if(e._queryParams.loadsAllData())return fl(t);{const n=e._queryIdentifier;return t.views.get(n)}}function dl(t,e){return null!=ul(t,e)}function pl(t){return null!=fl(t)}function fl(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let gl=1;class _l{constructor(t){this.listenProvider_=t,this.syncPointTree_=new vh(null),this.pendingWriteTree_={visibleWrites:wh.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function ml(t,n,i,s,r){return function(t,n,i,s,r){e(s>t.lastWriteId,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),t.allWrites.push({path:n,snap:i,writeId:s,visible:r}),r&&(t.visibleWrites=Ch(t.visibleWrites,n,i)),t.lastWriteId=s}(t.pendingWriteTree_,n,i,s,r),r?Tl(t,new hh({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},n,i)):[]}function yl(t,n,i=!1){const s=function(t,e){for(let n=0;n<t.allWrites.length;n++){const i=t.allWrites[n];if(i.writeId===e)return i}return null}(t.pendingWriteTree_,n);if(function(t,n){const i=t.allWrites.findIndex((t=>t.writeId===n));e(i>=0,"removeWrite called with nonexistent writeId.");const s=t.allWrites[i];t.allWrites.splice(i,1);let r=s.visible,o=!1,a=t.allWrites.length-1;for(;r&&a>=0;){const e=t.allWrites[a];e.visible&&(a>=i&&Ah(e,s.path)?r=!1:ia(s.path,e.path)&&(o=!0)),a--}return!!r&&(o?(function(t){t.visibleWrites=Oh(t.allWrites,Dh,$o()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}(t),!0):(s.snap?t.visibleWrites=Eh(t.visibleWrites,s.path):fo(s.children,(e=>{t.visibleWrites=Eh(t.visibleWrites,Zo(s.path,e))})),!0))}(t.pendingWriteTree_,n)){let e=new vh(null);return null!=s.snap?e=e.set($o(),!0):fo(s.children,(t=>{e=e.set(new Vo(t),!0)})),Tl(t,new oh(s.path,e,i))}return[]}function vl(t,e,n){return Tl(t,new hh({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,n))}function wl(t,n,i,s,r=!1){const o=n._path,a=t.syncPointTree_.get(o);let h=[];if(a&&("default"===n._queryIdentifier||dl(a,n))){const l=function(t,n,i,s){const r=n._queryIdentifier,o=[];let a=[];const h=pl(t);if("default"===r)for(const[e,n]of t.views.entries())a=a.concat(el(n,i,s)),tl(n)&&(t.views.delete(e),n.query._queryParams.loadsAllData()||o.push(n.query));else{const e=t.views.get(r);e&&(a=a.concat(el(e,i,s)),tl(e)&&(t.views.delete(r),e.query._queryParams.loadsAllData()||o.push(e.query)))}return h&&!pl(t)&&o.push(new(e(sl,"Reference.ts has not been loaded"),sl)(n._repo,n._path)),{removed:o,events:a}}(a,n,i,s);0===a.views.size&&(t.syncPointTree_=t.syncPointTree_.remove(o));const c=l.removed;if(h=l.events,!r){const e=-1!==c.findIndex((t=>t._queryParams.loadsAllData())),i=t.syncPointTree_.findOnPath(o,((t,e)=>pl(e)));if(e&&!i){const e=t.syncPointTree_.subtree(o);if(!e.isEmpty()){const n=function(t){return t.fold(((t,e,n)=>{if(e&&pl(e))return[fl(e)];{let t=[];return e&&(t=ll(e)),fo(n,((e,n)=>{t=t.concat(n)})),t}}))}(e);for(let e=0;e<n.length;++e){const i=n[e],s=i.query,r=kl(t,i);t.listenProvider_.startListening(Dl(s),Nl(t,s),r.hashFn,r.onComplete)}}}if(!i&&c.length>0&&!s)if(e){const e=null;t.listenProvider_.stopListening(Dl(n),e)}else c.forEach((e=>{const n=t.queryToTagMap.get(Pl(e));t.listenProvider_.stopListening(Dl(e),n)}))}!function(t,e){for(let n=0;n<e.length;++n){const i=e[n];if(!i._queryParams.loadsAllData()){const e=Pl(i),n=t.queryToTagMap.get(e);t.queryToTagMap.delete(e),t.tagToQueryMap.delete(n)}}}(t,c)}return h}function Cl(t,e,n,i){const s=Rl(t,i);if(null!=s){const i=xl(s),r=i.path,o=i.queryId,a=ea(r,e);return Al(t,r,new hh(rh(o),a,n))}return[]}function bl(t,n,i,s=!1){const r=n._path;let o=null,a=!1;t.syncPointTree_.foreachOnPath(r,((t,e)=>{const n=ea(t,r);o=o||cl(e,n),a=a||pl(e)}));let h,l=t.syncPointTree_.get(r);l?(a=a||pl(l),o=o||cl(l,$o())):(l=new ol,t.syncPointTree_=t.syncPointTree_.set(r,l)),null!=o?h=!0:(h=!1,o=La.EMPTY_NODE,t.syncPointTree_.subtree(r).foreachChild(((t,e)=>{const n=cl(e,$o());n&&(o=o.updateImmediateChild(t,n))})));const c=dl(l,n);if(!c&&!n._queryParams.loadsAllData()){const i=Pl(n);e(!t.queryToTagMap.has(i),"View does not exist, but we have a tag");const s=gl++;t.queryToTagMap.set(i,s),t.tagToQueryMap.set(s,i)}let u=function(t,e,n,i,s,r){const o=hl(t,e,i,s,r);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),function(t,e){t.eventRegistrations_.push(e)}(o,n),function(t,e){const n=t.viewCache_.eventCache,i=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(ka,((t,e)=>{i.push(Ha(t,e))})),n.isFullyInitialized()&&i.push(Ba(n.getNode())),il(t,i,n.getNode(),e)}(o,n)}(l,n,i,xh(t.pendingWriteTree_,r),o,h);if(!c&&!a&&!s){const i=ul(l,n);u=u.concat(function(t,n,i){const s=n._path,r=Nl(t,n),o=kl(t,i),a=t.listenProvider_.startListening(Dl(n),r,o.hashFn,o.onComplete),h=t.syncPointTree_.subtree(s);if(r)e(!pl(h.value),"If we're adding a query, it shouldn't be shadowed");else{const e=h.fold(((t,e,n)=>{if(!ta(t)&&e&&pl(e))return[fl(e).query];{let t=[];return e&&(t=t.concat(ll(e).map((t=>t.query)))),fo(n,((e,n)=>{t=t.concat(n)})),t}}));for(let n=0;n<e.length;++n){const i=e[n];t.listenProvider_.stopListening(Dl(i),Nl(t,i))}}return a}(t,n,i))}return u}function El(t,e,n){const i=t.pendingWriteTree_,s=t.syncPointTree_.findOnPath(e,((t,n)=>{const i=cl(n,ea(t,e));if(i)return i}));return Lh(i,e,s,n,!0)}function Tl(t,e){return Il(e,t.syncPointTree_,null,xh(t.pendingWriteTree_,$o()))}function Il(t,e,n,i){if(ta(t.path))return Sl(t,e,n,i);{const s=e.get($o());null==n&&null!=s&&(n=cl(s,$o()));let r=[];const o=Yo(t.path),a=t.operationForChild(o),h=e.children.get(o);if(h&&a){const t=n?n.getImmediateChild(o):null,e=Bh(i,o);r=r.concat(Il(a,h,t,e))}return s&&(r=r.concat(al(s,t,i,n))),r}}function Sl(t,e,n,i){const s=e.get($o());null==n&&null!=s&&(n=cl(s,$o()));let r=[];return e.children.inorderTraversal(((e,s)=>{const o=n?n.getImmediateChild(e):null,a=Bh(i,e),h=t.operationForChild(e);h&&(r=r.concat(Sl(h,s,o,a)))})),s&&(r=r.concat(al(s,t,i,n))),r}function kl(t,e){const n=e.query,i=Nl(t,n);return{hashFn:()=>{const t=function(t){return t.viewCache_.serverCache.getNode()}(e)||La.EMPTY_NODE;return t.hash()},onComplete:e=>{if("ok"===e)return i?function(t,e,n){const i=Rl(t,n);if(i){const n=xl(i),s=n.path,r=n.queryId,o=ea(s,e);return Al(t,s,new ah(rh(r),o))}return[]}(t,n._path,i):function(t,e){return Tl(t,new ah({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e))}(t,n._path);{const i=function(t,e){let n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===t?n="Client doesn't have permission to access the desired data.":"unavailable"===t&&(n="The service is unavailable");const i=new Error(t+" at "+e._path.toString()+": "+n);return i.code=t.toUpperCase(),i}(e,n);return wl(t,n,null,i)}}}}function Nl(t,e){const n=Pl(e);return t.queryToTagMap.get(n)}function Pl(t){return t._path.toString()+"$"+t._queryIdentifier}function Rl(t,e){return t.tagToQueryMap.get(e)}function xl(t){const n=t.indexOf("$");return e(-1!==n&&n<t.length-1,"Bad queryKey."),{queryId:t.substr(n+1),path:new Vo(t.substr(0,n))}}function Al(t,n,i){const s=t.syncPointTree_.get(n);return e(s,"Missing sync point for query tag that we're tracking"),al(s,i,xh(t.pendingWriteTree_,n),null)}function Dl(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(e(rl,"Reference.ts has not been loaded"),rl)(t._repo,t._path):t}class Ol{constructor(t){this.node_=t}getImmediateChild(t){const e=this.node_.getImmediateChild(t);return new Ol(e)}node(){return this.node_}}class Ll{constructor(t,e){this.syncTree_=t,this.path_=e}getImmediateChild(t){const e=Zo(this.path_,t);return new Ll(this.syncTree_,e)}node(){return El(this.syncTree_,this.path_)}}const Ml=function(t){return(t=t||{}).timestamp=t.timestamp||(new Date).getTime(),t},Fl=function(t,n,i){return t&&"object"==typeof t?(e(".sv"in t,"Unexpected leaf node or priority contents"),"string"==typeof t[".sv"]?ql(t[".sv"],n,i):"object"==typeof t[".sv"]?Ul(t[".sv"],n):void e(!1,"Unexpected server value: "+JSON.stringify(t,null,2))):t},ql=function(t,n,i){if("timestamp"===t)return i.timestamp;e(!1,"Unexpected server value: "+t)},Ul=function(t,n,i){t.hasOwnProperty("increment")||e(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const s=t.increment;"number"!=typeof s&&e(!1,"Unexpected increment value: "+s);const r=n.node();if(e(null!=r,"Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return s;const o=r.getValue();return"number"!=typeof o?s:o+s},jl=function(t,e,n,i){return Hl(e,new Ll(n,t),i)},Bl=function(t,e,n){return Hl(t,new Ol(e),n)};function Hl(t,e,n){const i=t.getPriority().val(),s=Fl(i,e.getImmediateChild(".priority"),n);let r;if(t.isLeafNode()){const i=t,r=Fl(i.getValue(),e,n);return r!==i.getValue()||s!==i.getPriority().val()?new Sa(r,qa(s)):t}{const i=t;return r=i,s!==i.getPriority().val()&&(r=r.updatePriority(new Sa(s))),i.forEachChild(ka,((t,i)=>{const s=Hl(i,e.getImmediateChild(t),n);s!==i&&(r=r.updateImmediateChild(t,s))})),r}}class zl{constructor(t="",e=null,n={children:{},childCount:0}){this.name=t,this.parent=e,this.node=n}}function Wl(t,e){let n=e instanceof Vo?e:new Vo(e),i=t,s=Yo(n);for(;null!==s;){const t=b(i.node.children,s)||{children:{},childCount:0};i=new zl(s,i,t),n=Go(n),s=Yo(n)}return i}function Vl(t){return t.node.value}function $l(t,e){t.node.value=e,Ql(t)}function Yl(t){return t.node.childCount>0}function Kl(t,e){fo(t.node.children,((n,i)=>{e(new zl(n,t,i))}))}function Gl(t,e,n,i){n&&!i&&e(t),Kl(t,(t=>{Gl(t,e,!0,i)})),n&&i&&e(t)}function Xl(t){return new Vo(null===t.parent?t.name:Xl(t.parent)+"/"+t.name)}function Ql(t){null!==t.parent&&function(t,e,n){const i=function(t){return void 0===Vl(t)&&!Yl(t)}(n),s=C(t.node.children,e);i&&s?(delete t.node.children[e],t.node.childCount--,Ql(t)):i||s||(t.node.children[e]=n.node,t.node.childCount++,Ql(t))}(t.parent,t.name,t)}const Jl=/[\[\].#$\/\u0000-\u001F\u007F]/,Zl=/[\[\].#$\u0000-\u001F\u007F]/,tc=10485760,ec=function(t){return"string"==typeof t&&0!==t.length&&!Jl.test(t)},nc=function(t){return"string"==typeof t&&0!==t.length&&!Zl.test(t)},ic=function(t,e,n){const i=n instanceof Vo?new sa(n,t):n;if(void 0===e)throw new Error(t+"contains undefined "+oa(i));if("function"==typeof e)throw new Error(t+"contains a function "+oa(i)+" with contents = "+e.toString());if(ro(e))throw new Error(t+"contains "+e.toString()+" "+oa(i));if("string"==typeof e&&e.length>tc/3&&P(e)>tc)throw new Error(t+"contains a string greater than "+tc+" utf8 bytes "+oa(i)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let n=!1,s=!1;if(fo(e,((e,r)=>{if(".value"===e)n=!0;else if(".priority"!==e&&".sv"!==e&&(s=!0,!ec(e)))throw new Error(t+" contains an invalid key ("+e+") "+oa(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=P(e),ra(t)}(i,e),ic(t,r,i),function(t){const e=t.parts_.pop();t.byteLength_-=P(e),t.parts_.length>0&&(t.byteLength_-=1)}(i)})),n&&s)throw new Error(t+' contains ".value" child '+oa(i)+" in addition to actual children.")}},sc=function(t,e,n,i){if(!(i&&void 0===n||nc(n)))throw new Error(N(t,e)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},rc=function(t,e,n,i){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),sc(t,e,n,i)};class oc{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function ac(t,e,n){(function(t,e){let n=null;for(let i=0;i<e.length;i++){const s=e[i],r=s.getPath();null===n||na(r,n.path)||(t.eventLists_.push(n),n=null),null===n&&(n={events:[],path:r}),n.events.push(s)}n&&t.eventLists_.push(n)})(t,n),function(t,e){t.recursionDepth_++;let n=!0;for(let i=0;i<t.eventLists_.length;i++){const s=t.eventLists_[i];s&&(e(s.path)?(hc(t.eventLists_[i]),t.eventLists_[i]=null):n=!1)}n&&(t.eventLists_=[]),t.recursionDepth_--}(t,(t=>ia(t,e)||ia(e,t)))}function hc(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(null!==n){t.events[e]=null;const i=n.getEventRunner();Jr&&to("event: "+n.toString()),yo(i)}}}const lc=25;class cc{constructor(t,e,n,i){this.repoInfo_=t,this.forceRestClient_=e,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new oc,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Za(),this.transactionQueueTree_=new zl,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function uc(t,e,n){if(t.stats_=Do(t.repoInfo_),t.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)t.server_=new Qa(t.repoInfo_,((e,n,i,s)=>{fc(t,e,n,i,s)}),t.authTokenProvider_,t.appCheckProvider_),setTimeout((()=>gc(t,!0)),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{v(n)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}t.persistentConnection_=new la(t.repoInfo_,e,((e,n,i,s)=>{fc(t,e,n,i,s)}),(e=>{gc(t,e)}),(e=>{!function(t,e){fo(e,((e,n)=>{_c(t,e,n)}))}(t,e)}),t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener((e=>{t.server_.refreshAuthToken(e)})),t.appCheckProvider_.addTokenChangeListener((e=>{t.server_.refreshAppCheckToken(e.token)})),t.statsReporter_=function(e,n){const i=e.toString();return Ao[i]||(Ao[i]=new ih(t.stats_,t.server_)),Ao[i]}(t.repoInfo_),t.infoData_=new Ja,t.infoSyncTree_=new _l({startListening:(e,n,i,s)=>{let r=[];const o=t.infoData_.getNode(e._path);return o.isEmpty()||(r=vl(t.infoSyncTree_,e._path,o),setTimeout((()=>{s("ok")}),0)),r},stopListening:()=>{}}),_c(t,"connected",!1),t.serverSyncTree_=new _l({startListening:(e,n,i,s)=>(t.server_.listen(e,i,n,((n,i)=>{const r=s(n,i);ac(t.eventQueue_,e._path,r)})),[]),stopListening:(e,n)=>{t.server_.unlisten(e,n)}})}function dc(t){const e=t.infoData_.getNode(new Vo(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+e}function pc(t){return Ml({timestamp:dc(t)})}function fc(t,e,n,i,s){t.dataUpdateCount++;const r=new Vo(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(s)if(i){const e=T(n,(t=>qa(t)));o=function(t,e,n,i){const s=Rl(t,i);if(s){const i=xl(s),r=i.path,o=i.queryId,a=ea(r,e),h=vh.fromObject(n);return Al(t,r,new lh(rh(o),a,h))}return[]}(t.serverSyncTree_,r,e,s)}else{const e=qa(n);o=Cl(t.serverSyncTree_,r,e,s)}else if(i){const e=T(n,(t=>qa(t)));o=function(t,e,n){const i=vh.fromObject(n);return Tl(t,new lh({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,i))}(t.serverSyncTree_,r,e)}else{const e=qa(n);o=vl(t.serverSyncTree_,r,e)}let a=r;o.length>0&&(a=Cc(t,r)),ac(t.eventQueue_,a,o)}function gc(t,e){_c(t,"connected",e),!1===e&&function(t){yc(t,"onDisconnectEvents");const e=pc(t),n=Za();eh(t.onDisconnect_,$o(),((i,s)=>{const r=jl(i,s,t.serverSyncTree_,e);th(n,i,r)}));let i=[];eh(n,$o(),((e,n)=>{i=i.concat(vl(t.serverSyncTree_,e,n));const s=function(t,e){const n=Xl(bc(t,e)),i=Wl(t.transactionQueueTree_,e);return function(t,e,n){let i=void 0?t:t.parent;for(;null!==i;){if(e(i))return!0;i=i.parent}}(i,(e=>{Sc(t,e)})),Sc(t,i),Gl(i,(e=>{Sc(t,e)})),n}(t,e);Cc(t,s)})),t.onDisconnect_=Za(),ac(t.eventQueue_,$o(),i)}(t)}function _c(t,e,n){const i=new Vo("/.info/"+e),s=qa(n);t.infoData_.updateSnapshot(i,s);const r=vl(t.infoSyncTree_,i,s);ac(t.eventQueue_,i,r)}function mc(t){return t.nextWriteId_++}function yc(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),to(n,...e)}function vc(t,e,n){return El(t.serverSyncTree_,e,n)||La.EMPTY_NODE}function wc(t,n=t.transactionQueueTree_){if(n||Ic(t,n),Vl(n)){const i=Ec(t,n);e(i.length>0,"Sending zero length transaction queue"),i.every((t=>0===t.status))&&function(t,n,i){const s=i.map((t=>t.currentWriteId)),r=vc(t,n,s);let o=r;const a=r.hash();for(let t=0;t<i.length;t++){const s=i[t];e(0===s.status,"tryToSendTransactionQueue_: items in queue should all be run."),s.status=1,s.retryCount++;const r=ea(n,s.path);o=o.updateChild(r,s.currentOutputSnapshotRaw)}const h=o.val(!0),l=n;t.server_.put(l.toString(),h,(e=>{yc(t,"transaction put response",{path:l.toString(),status:e});let s=[];if("ok"===e){const e=[];for(let n=0;n<i.length;n++)i[n].status=2,s=s.concat(yl(t.serverSyncTree_,i[n].currentWriteId)),i[n].onComplete&&e.push((()=>i[n].onComplete(null,!0,i[n].currentOutputSnapshotResolved))),i[n].unwatcher();Ic(t,Wl(t.transactionQueueTree_,n)),wc(t,t.transactionQueueTree_),ac(t.eventQueue_,n,s);for(let t=0;t<e.length;t++)yo(e[t])}else{if("datastale"===e)for(let t=0;t<i.length;t++)3===i[t].status?i[t].status=4:i[t].status=0;else{so("transaction at "+l.toString()+" failed: "+e);for(let t=0;t<i.length;t++)i[t].status=4,i[t].abortReason=e}Cc(t,n)}}),a)}(t,Xl(n),i)}else Yl(n)&&Kl(n,(e=>{wc(t,e)}))}function Cc(t,n){const i=bc(t,n),s=Xl(i);return function(t,n,i){if(0===n.length)return;const s=[];let r=[];const o=n.filter((t=>0===t.status)),a=o.map((t=>t.currentWriteId));for(let o=0;o<n.length;o++){const l=n[o],c=ea(i,l.path);let u,d=!1;if(e(null!==c,"rerunTransactionsUnderNode_: relativePath should not be null."),4===l.status)d=!0,u=l.abortReason,r=r.concat(yl(t.serverSyncTree_,l.currentWriteId,!0));else if(0===l.status)if(l.retryCount>=lc)d=!0,u="maxretry",r=r.concat(yl(t.serverSyncTree_,l.currentWriteId,!0));else{const e=vc(t,l.path,a);l.currentInputSnapshot=e;const i=n[o].update(e.val());if(void 0!==i){ic("transaction failed: Data returned ",i,l.path);let n=qa(i);"object"==typeof i&&null!=i&&C(i,".priority")||(n=n.updatePriority(e.getPriority()));const s=l.currentWriteId,o=pc(t),h=Bl(n,e,o);l.currentOutputSnapshotRaw=n,l.currentOutputSnapshotResolved=h,l.currentWriteId=mc(t),a.splice(a.indexOf(s),1),r=r.concat(ml(t.serverSyncTree_,l.path,h,l.currentWriteId,l.applyLocally)),r=r.concat(yl(t.serverSyncTree_,s,!0))}else d=!0,u="nodata",r=r.concat(yl(t.serverSyncTree_,l.currentWriteId,!0))}ac(t.eventQueue_,i,r),r=[],d&&(n[o].status=2,h=n[o].unwatcher,setTimeout(h,Math.floor(0)),n[o].onComplete&&("nodata"===u?s.push((()=>n[o].onComplete(null,!1,n[o].currentInputSnapshot))):s.push((()=>n[o].onComplete(new Error(u),!1,null)))))}var h;Ic(t,t.transactionQueueTree_);for(let t=0;t<s.length;t++)yo(s[t]);wc(t,t.transactionQueueTree_)}(t,Ec(t,i),s),s}function bc(t,e){let n,i=t.transactionQueueTree_;for(n=Yo(e);null!==n&&void 0===Vl(i);)i=Wl(i,n),n=Yo(e=Go(e));return i}function Ec(t,e){const n=[];return Tc(t,e,n),n.sort(((t,e)=>t.order-e.order)),n}function Tc(t,e,n){const i=Vl(e);if(i)for(let t=0;t<i.length;t++)n.push(i[t]);Kl(e,(e=>{Tc(t,e,n)}))}function Ic(t,e){const n=Vl(e);if(n){let t=0;for(let e=0;e<n.length;e++)2!==n[e].status&&(n[t]=n[e],t++);n.length=t,$l(e,n.length>0?n:void 0)}Kl(e,(e=>{Ic(t,e)}))}function Sc(t,n){const i=Vl(n);if(i){const s=[];let r=[],o=-1;for(let n=0;n<i.length;n++)3===i[n].status||(1===i[n].status?(e(o===n-1,"All SENT items should be at beginning of queue."),o=n,i[n].status=3,i[n].abortReason="set"):(e(0===i[n].status,"Unexpected transaction status in abort"),i[n].unwatcher(),r=r.concat(yl(t.serverSyncTree_,i[n].currentWriteId,!0)),i[n].onComplete&&s.push(i[n].onComplete.bind(null,new Error("set"),!1,null))));-1===o?$l(n,void 0):i.length=o+1,ac(t.eventQueue_,Xl(n),r);for(let t=0;t<s.length;t++)yo(s[t])}}const kc=function(t,e){const n=Nc(t),i=n.namespace;"firebase.com"===n.domain&&io(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||io("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&so("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const s="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new No(n.host,n.secure,i,s,e,"",i!==n.subdomain),path:new Vo(n.pathString)}},Nc=function(t){let e="",n="",i="",s="",r="",o=!0,a="https",h=443;if("string"==typeof t){let l=t.indexOf("//");l>=0&&(a=t.substring(0,l-1),t=t.substring(l+2));let c=t.indexOf("/");-1===c&&(c=t.length);let u=t.indexOf("?");-1===u&&(u=t.length),e=t.substring(0,Math.min(c,u)),c<u&&(s=function(t){let e="";const n=t.split("/");for(let t=0;t<n.length;t++)if(n[t].length>0){let i=n[t];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(t){}e+="/"+i}return e}(t.substring(c,u)));const d=function(t){const e={};"?"===t.charAt(0)&&(t=t.substring(1));for(const n of t.split("&")){if(0===n.length)continue;const i=n.split("=");2===i.length?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):so(`Invalid query segment '${n}' in query '${t}'`)}return e}(t.substring(Math.min(t.length,u)));l=e.indexOf(":"),l>=0?(o="https"===a||"wss"===a,h=parseInt(e.substring(l+1),10)):l=e.length;const p=e.slice(0,l);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{const t=e.indexOf(".");i=e.substring(0,t).toLowerCase(),n=e.substring(t+1),r=i}"ns"in d&&(r=d.ns)}return{host:e,port:h,domain:n,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}};class Pc{constructor(t,e,n,i){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=i}getPath(){const t=this.snapshot.ref;return"value"===this.eventType?t._path:t.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+v(this.snapshot.exportVal())}}class Rc{constructor(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class xc{constructor(t,e){this.snapshotCallback=t,this.cancelCallback=e}onValue(t,e){this.snapshotCallback.call(null,t,e)}onCancel(t){return e(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,t)}get hasCancelCallback(){return!!this.cancelCallback}matches(t){return this.snapshotCallback===t.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===t.snapshotCallback.userCallback&&this.snapshotCallback.context===t.snapshotCallback.context}}class Ac{constructor(t,e,n,i){this._repo=t,this._path=e,this._queryParams=n,this._orderByCalled=i}get key(){return ta(this._path)?null:Xo(this._path)}get ref(){return new Dc(this._repo,this._path)}get _queryIdentifier(){const t=Xa(this._queryParams),e=uo(t);return"{}"===e?"default":e}get _queryObject(){return Xa(this._queryParams)}isEqual(t){if(!((t=R(t))instanceof Ac))return!1;const e=this._repo===t._repo,n=na(this._path,t._path),i=this._queryIdentifier===t._queryIdentifier;return e&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)""!==t.pieces_[n]&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}(this._path)}}class Dc extends Ac{constructor(t,e){super(t,e,new Ka,!1)}get parent(){const t=Jo(this._path);return null===t?null:new Dc(this._repo,t)}get root(){let t=this;for(;null!==t.parent;)t=t.parent;return t}}class Oc{constructor(t,e,n){this._node=t,this.ref=e,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(t){const e=new Vo(t),n=Lc(this.ref,t);return new Oc(this._node.getChild(e),n,ka)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(t){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,((e,n)=>t(new Oc(n,Lc(this.ref,e),ka))))}hasChild(t){const e=new Vo(t);return!this._node.getChild(e).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Lc(t,e){return null===Yo((t=R(t))._path)?rc("child","path",e,!1):sc("child","path",e,!1),new Dc(t._repo,Zo(t._path,e))}function Mc(t){t=R(t);const e=new xc((()=>{})),n=new Fc(e);return function(t,e,n){const i=function(t,e){const n=e._path;let i=null;t.syncPointTree_.foreachOnPath(n,((t,e)=>{const s=ea(t,n);i=i||cl(e,s)}));let s=t.syncPointTree_.get(n);s?i=i||cl(s,$o()):(s=new ol,t.syncPointTree_=t.syncPointTree_.set(n,s));const r=null!=i,o=r?new ch(i,!0,!1):null;return _h(hl(s,e,xh(t.pendingWriteTree_,e._path),r?o.getNode():La.EMPTY_NODE,r).viewCache_)}(t.serverSyncTree_,e);return null!=i?Promise.resolve(i):t.server_.get(e).then((i=>{const s=qa(i).withIndex(e._queryParams.getIndex());let r;if(bl(t.serverSyncTree_,e,n,!0),e._queryParams.loadsAllData())r=vl(t.serverSyncTree_,e._path,s);else{const n=Nl(t.serverSyncTree_,e);r=Cl(t.serverSyncTree_,e._path,s,n)}return ac(t.eventQueue_,e._path,r),wl(t.serverSyncTree_,e,n,null,!0),s}),(n=>(yc(t,"get for query "+v(e)+" failed: "+n),Promise.reject(new Error(n)))))}(t._repo,t,n).then((e=>new Oc(e,new Dc(t._repo,t._path),t._queryParams.getIndex())))}class Fc{constructor(t){this.callbackContext=t}respondsTo(t){return"value"===t}createEvent(t,e){const n=e._queryParams.getIndex();return new Pc("value",this,new Oc(t.snapshotNode,new Dc(e._repo,e._path),n))}getEventRunner(t){return"cancel"===t.getEventType()?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,null)}createCancelEvent(t,e){return this.callbackContext.hasCancelCallback?new Rc(this,t,e):null}matches(t){return t instanceof Fc&&(!t.callbackContext||!this.callbackContext||t.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}!function(t){e(!sl,"__referenceConstructor has already been defined"),sl=t}(Dc),function(t){e(!rl,"__referenceConstructor has already been defined"),rl=t}(Dc);const qc={};function Uc(t,e,n,i,s){let r=i||t.options.databaseURL;void 0===r&&(t.options.projectId||io("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),to("Using default host for project ",t.options.projectId),r=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o,a,h=kc(r,s),l=h.repoInfo;"undefined"!=typeof process&&process.env&&(a=process.env.FIREBASE_DATABASE_EMULATOR_HOST),a?(o=!0,r=`http://${a}?ns=${l.namespace}`,h=kc(r,s),l=h.repoInfo):o=!h.repoInfo.secure;const c=s&&o?new bo(bo.OWNER):new Co(t.name,t.options,e);(function(t,e){const n=e.path.toString();if("string"!=typeof e.repoInfo.host||0===e.repoInfo.host.length||!ec(e.repoInfo.namespace)&&"localhost"!==e.repoInfo.host.split(":")[0]||0!==n.length&&!function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),nc(t)}(n))throw new Error(N(t,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')})("Invalid Firebase Database URL",h),ta(h.path)||io("Database URL must point to the root of a Firebase Database (not including a child path).");const u=function(t,e,n,i){let s=qc[e.name];s||(s={},qc[e.name]=s);let r=s[t.toURLString()];return r&&io("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new cc(t,false,n,i),s[t.toURLString()]=r,r}(l,t,c,new wo(t.name,n));return new jc(u,t)}class jc{constructor(t,e){this._repoInternal=t,this.app=e,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(uc(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Dc(this._repo,$o())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(t,e){const n=qc[e];n&&n[t.key]===t||io(`Database ${e}(${t.repoInfo_}) has already been deleted.`),function(t){t.persistentConnection_&&t.persistentConnection_.interrupt("repo_interrupt")}(t),delete n[t.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(t){null===this._rootInternal&&io("Cannot call "+t+" on a deleted database.")}}la.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},la.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)},Hr=yt,gt(new x("database",((t,{instanceIdentifier:e})=>Uc(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"),t.getProvider("app-check-internal"),e)),"PUBLIC").setMultipleInstances(!0)),wt(jr,Br,void 0),wt(jr,Br,"esm2017"),vt({apiKey:"AIzaSyAcALo35rzpUWNqp1J6X1hTiqp51OP30gg",authDomain:"saveon-ae7c9.firebaseapp.com",databaseURL:"https://saveon-ae7c9-default-rtdb.firebaseio.com",projectId:"saveon-ae7c9",storageBucket:"saveon-ae7c9.appspot.com",messagingSenderId:"90501248489",appId:"1:90501248489:web:a659884b52a87b643fc778",measurementId:"G-ELXCWED5EC"});var Bc=function(t,e){return(t=R(t))._checkNotDeleted("ref"),void 0!==e?Lc(t._root,e):t._root}(function(t=function(t=ct){const e=dt.get(t);if(!e&&t===ct&&d())return vt();if(!e)throw _t.create("no-app",{appName:t});return e}(),e){const n=function(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const t=(t=>{const e=(t=>{var e,n;return null===(n=null===(e=u())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),i]:[e.substring(0,n),i]})("database");t&&function(t,e,n,i={}){(t=R(t))._checkNotDeleted("useEmulator"),t._instanceStarted&&io("Cannot call useEmulator() after instance has already been initialized.");const s=t._repoInternal;let r;if(s.repoInfo_.nodeAdmin)i.mockUserToken&&io('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new bo(bo.OWNER);else if(i.mockUserToken){const e="string"==typeof i.mockUserToken?i.mockUserToken:function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",i=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const r=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[a(JSON.stringify({alg:"none",type:"JWT"})),a(JSON.stringify(r)),""].join(".")}(i.mockUserToken,t.app.options.projectId);r=new bo(e)}!function(t,e,n,i){t.repoInfo_=new No(`${e}:${n}`,!1,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0),i&&(t.authTokenProvider_=i)}(s,e,n,r)}(n,...t)}return n}());Mc(Lc(Bc,"products")).then((function(t){t.exists()?function(t){if(console.log(t),t){console.log(t),document.body;var e=document.getElementById("products");for(var n in t){var i=document.createElement("tr"),s=t[n];for(var r in s){var o=s[r],a=document.createElement("td");a.textContent=r+": "+o+"     ",i.appendChild(a)}e.appendChild(i)}}}(t.val()):console.log("No data available")})).catch((function(t){console.error(t)}))})();